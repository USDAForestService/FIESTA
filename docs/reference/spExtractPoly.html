<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Spatial - Extracts point attribute values from SpatialPolygons layer(s). — spExtractPoly • FIESTA</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Spatial - Extracts point attribute values from SpatialPolygons layer(s). — spExtractPoly"><meta property="og:description" content="Extracts values from one or more polygon layers and appends to input
SpatialPoints layer or data frame. Points are reprojected on-the-fly to
projection of SpatialPolygons using PROJ.4 transformation parameters and
rgdal spTransform function."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">FIESTA</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">3.4.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/FIESTA_manual_mod_est.html">`FIESTA` Manual - Module Estimates</a>
    </li>
    <li>
      <a href="../articles/FIESTA_manual_mod_pop.html">`FIESTA` Manual - Population Data</a>
    </li>
    <li>
      <a href="../articles/FIESTA_tutorial_DB.html">FIESTA - Database Tools</a>
    </li>
    <li>
      <a href="../articles/FIESTA_tutorial_GB.html">FIESTA - Green-book Estimators</a>
    </li>
    <li>
      <a href="../articles/FIESTA_tutorial_MA.html">FIESTA - Model-Assisted Estimators</a>
    </li>
    <li>
      <a href="../articles/FIESTA_tutorial_PB.html">FIESTA - Photo-Based Module</a>
    </li>
    <li>
      <a href="../articles/FIESTA_tutorial_SA.html">FIESTA - Small Area Estimators</a>
    </li>
    <li>
      <a href="../articles/FIESTA_tutorial_dat.html">FIESTA - Data Tools</a>
    </li>
    <li>
      <a href="../articles/FIESTA_tutorial_sp.html">FIESTA - Spatial Tools</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Spatial - Extracts point attribute values from SpatialPolygons layer(s).</h1>
    
    <div class="hidden name"><code>spExtractPoly.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Extracts values from one or more polygon layers and appends to input
SpatialPoints layer or data frame. Points are reprojected on-the-fly to
projection of SpatialPolygons using PROJ.4 transformation parameters and
rgdal spTransform function.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">spExtractPoly</span><span class="op">(</span>
  <span class="va">xyplt</span>,
  xyplt_dsn <span class="op">=</span> <span class="cn">NULL</span>,
  xy.uniqueid <span class="op">=</span> <span class="st">"PLT_CN"</span>,
  <span class="va">polyvlst</span>,
  polyv_dsn <span class="op">=</span> <span class="cn">NULL</span>,
  polyvarlst <span class="op">=</span> <span class="cn">NULL</span>,
  polyvarnmlst <span class="op">=</span> <span class="cn">NULL</span>,
  keepNA <span class="op">=</span> <span class="cn">FALSE</span>,
  showext <span class="op">=</span> <span class="cn">FALSE</span>,
  savedata <span class="op">=</span> <span class="cn">FALSE</span>,
  exportsp <span class="op">=</span> <span class="cn">FALSE</span>,
  exportNA <span class="op">=</span> <span class="cn">FALSE</span>,
  spMakeSpatial_opts <span class="op">=</span> <span class="cn">NULL</span>,
  savedata_opts <span class="op">=</span> <span class="cn">NULL</span>,
  gui <span class="op">=</span> <span class="cn">FALSE</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>xyplt</dt>
<dd><p>Data frame object or String. Name of layer with xy coordinates
and unique identifier. Can be layer with xy_dsn, full pathname, including
extension, or file name (with extension) in xy_dsn folder.</p></dd>
<dt>xyplt_dsn</dt>
<dd><p>String. Name of database where xyplt is. The dsn varies by
driver. See gdal OGR vector formats (https://www.gdal.org/ogr_formats.html).</p></dd>
<dt>xy.uniqueid</dt>
<dd><p>String.* Unique identifier of xyplt rows.</p></dd>
<dt>polyvlst</dt>
<dd><p>sf R object or String. Name(s) of polygon layers to extract
values. A spatial polygon object, full path to shapefile, or name of a layer
within a database.</p></dd>
<dt>polyv_dsn</dt>
<dd><p>String. Data source name (dsn) where polyvlst layers are
found (e.g., *.sqlite, *.gdb, folder name). The dsn varies by driver.  See
gdal OGR vector formats (https://www.gdal.org/ogr_formats.html).</p></dd>
<dt>polyvarlst</dt>
<dd><p>String vector or list. The name(s) of variable(s) to
extract from polygon(s). If extracting multiple variables from more than one
polygon, specify names in a list format, corresponding to polyvlst.</p></dd>
<dt>polyvarnmlst</dt>
<dd><p>String vector or list. Output name(s) of variable(s)
extracted from polygon(s). If extracting multiple variables from more than
one polygon, specify names in a list format, corresponding to polyvlst. The
number of names must match the number of variables in polyvarlst.</p></dd>
<dt>keepNA</dt>
<dd><p>Logical. If TRUE, keep NA values.</p></dd>
<dt>showext</dt>
<dd><p>Logical. If TRUE, layer extents are displayed in plot window.</p></dd>
<dt>savedata</dt>
<dd><p>Logical. If TRUE, the input data with extracted values are
saved to outfolder.</p></dd>
<dt>exportsp</dt>
<dd><p>Logical. If TRUE, the extracted point data are exported to
outfolder.</p></dd>
<dt>exportNA</dt>
<dd><p>Logical. If TRUE, NULL values are exported to outfolder.</p></dd>
<dt>spMakeSpatial_opts</dt>
<dd><p>List. See help(spMakeSpatial_options()) for a list
of options. Use to convert X/Y values to simple feature (sf) coordinates.</p></dd>
<dt>savedata_opts</dt>
<dd><p>List. See help(savedata_options()) for a list
of options. Only used when savedata = TRUE. If out_layer = NULL,
default = 'polyext'.</p></dd>
<dt>gui</dt>
<dd><p>Logical. If gui, user is prompted for parameters.</p></dd>
</dl></div>
    <div id="value">
    <h2>Value</h2>
    <dl><dt>pltdat</dt>
<dd><p>SpatialPointsDataFrame object or data frame. Input
point data with extracted raster values appended. For multi-part polygons,
more than 1 row per point may be output.</p></dd>
<dt>var.name</dt>
<dd><p>String vector.
Variable names of extracted variables.</p></dd>
</dl><p>If savedata=TRUE, outdat data frame is saved to outfolder (Default name:
datext_'date'.csv).  If exportsp=TRUE, the SpatialPointsDataFrame object is
exported to outfolder (Default name: datext_'date'.shp). Variable names are
truncated to 10 characters or less (See note below). Name changes are output
to 'outfn'_newnames_'data'.csv in outfolder.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>*If variable = NULL, then it will prompt user for input.</p>
<p>keepnull<br> If keepnull=FALSE, points are excluded when all extracted
variables from any one SpatialPolygons are NULL, returning the points that
fall within the ' intersecting polygons.</p>
    </div>
    <div id="note">
    <h2>Note</h2>
    <p>If exportshp=TRUE:<br> The writeOGR (rgdal) function is called. The ArcGIS
driver truncates variable names to 10 characters or less. Variable names are
changed before export using an internal function (trunc10shp). If Spatial
object has more than 1 record, it will be returned but not exported.</p>
<p>The spTransform (rgdal) method is used for on-the-fly map projection
conversion and datum transformation using PROJ.4 arguments. Datum
transformation only occurs if the +datum tag is present in the both the from
and to PROJ.4 strings. The +towgs84 tag is used when no datum transformation
is needed. PROJ.4 transformations assume NAD83 and WGS84 are identical
unless other transformation parameters are specified.  Be aware, providing
inaccurate or incomplete CRS information may lead to erroneous data shifts
when reprojecting. See spTransform help documentation for more details.</p>
<p>Any names in polygon layers that are the same as in xyplt are renamed to
name'_1'.</p>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Tracey S. Frescino</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="co"># Get point data from WYplt data in FIESTA</span></span>
<span class="r-in"><span class="va">WYplt</span> <span class="op">&lt;-</span> <span class="fu">FIESTA</span><span class="fu">::</span><span class="va"><a href="WYplt.html">WYplt</a></span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Get polygon vector layer from FIESTA external data</span></span>
<span class="r-in"><span class="va">WYbhdistfn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>,</span>
<span class="r-in">                          <span class="st">"sp_data/WYbighorn_districtbnd.shp"</span>,</span>
<span class="r-in">                          package <span class="op">=</span> <span class="st">"FIESTA"</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Extract points from polygon vector layer</span></span>
<span class="r-in"><span class="va">xyext</span> <span class="op">&lt;-</span> <span class="fu">spExtractPoly</span><span class="op">(</span>xyplt <span class="op">=</span> <span class="va">WYplt</span>,</span>
<span class="r-in">                       polyvlst <span class="op">=</span> <span class="va">WYbhdistfn</span>,</span>
<span class="r-in">                       xy.uniqueid <span class="op">=</span> <span class="st">"CN"</span>,</span>
<span class="r-in">                       spMakeSpatial_opts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>xvar <span class="op">=</span> <span class="st">"LON_PUBLIC"</span>,</span>
<span class="r-in">                                                 yvar <span class="op">=</span> <span class="st">"LAT_PUBLIC"</span>,</span>
<span class="r-in">                                                 xy.crs <span class="op">=</span> <span class="fl">4269</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> crs.default must be in a projected CRS... using US albers</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> +proj=aea +lat_0=23 +lon_0=-96 +lat_1=29.5 +lat_2=45.5 +x_0=0 +y_0=0 +datum=NAD83 +units=m +no_defs +type=crs</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> reprojecting layer... </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  from: EPSG:4269 </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  to: +proj=aea +lat_0=23 +lon_0=-96 +lat_1=29.5 +lat_2=45.5 +x_0=0 +y_0=0 +datum=NAD83 +units=m +no_defs +type=crs</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>there are 2991 null values for poly1</span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">xyext</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "spxyext"  "outnames" "NAlst"   </span>
<span class="r-in"><span class="va">xyext</span><span class="op">$</span><span class="va">outnames</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       REGION   FORESTNUMB   DISTRICTNU   DISTRICTNA </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     "REGION" "FORESTNUMB" "DISTRICTNU" "DISTRICTNA" </span>
<span class="r-in"><span class="va">spxyext</span> <span class="op">&lt;-</span> <span class="va">xyext</span><span class="op">$</span><span class="va">spxyext</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">spxyext</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Simple feature collection with 6 features and 22 fields</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Geometry type: POINT</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dimension:     XY</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Bounding box:  xmin: -943048.1 ymin: 2461728 xmax: -914104.9 ymax: 2492354</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> CRS:           +proj=aea +lat_0=23 +lon_0=-96 +lat_1=29.5 +lat_2=45.5 +x_0=0 +y_0=0 +datum=NAD83 +units=m +no_defs +type=crs</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 CN INVYR STATECD CYCLE UNITCD COUNTYCD  PLOT MEASYEAR RDDISTCD</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 142 40404876010690  2012      56     3      2        3 83143     2012        6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 145 40404879010690  2011      56     3      2        3 80153     2011        6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 152 40404886010690  2012      56     3      2        3 86397     2012       NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 159 40404893010690  2011      56     3      2        3 85901     2011        4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 160 40404894010690  2013      56     3      2        3 90221     2013        6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 165 40404899010690  2013      56     3      2        3 85144     2013       NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     NF_SAMPLING_STATUS_CD PLOT_STATUS_CD NF_PLOT_STATUS_CD NBRCND NBRCNDSAMP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 142                     0              1                NA      2          2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 145                     0              1                NA      1          1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 152                     0              2                NA      1          1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 159                     0              1                NA      1          1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 160                     0              1                NA      1          1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 165                     0              2                NA      1          1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     NBRCNDFOR CCLIVEPLT        FORNONSAMP        PLOT_ID REGION FORESTNUMB</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 142         2      67.5    Sampled-Forest ID560200383143     02         02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 145         1      66.0    Sampled-Forest ID560200380153     02         02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 152         0       0.0 Sampled-Nonforest ID560200386397     02         02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 159         1      48.0    Sampled-Forest ID560200385901     02         02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 160         1       2.0    Sampled-Forest ID560200390221     02         02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 165         0       8.0 Sampled-Nonforest ID560200385144     02         02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     DISTRICTNU                     DISTRICTNA                  geometry</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 142         03 Medicine Wheel Ranger District POINT (-937172.9 2492354)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 145         03 Medicine Wheel Ranger District POINT (-943048.1 2487710)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 152         03 Medicine Wheel Ranger District POINT (-928130.7 2476936)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 159         03 Medicine Wheel Ranger District POINT (-919787.2 2464822)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 160         03 Medicine Wheel Ranger District POINT (-914104.9 2465931)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 165         03 Medicine Wheel Ranger District POINT (-930324.7 2461728)</span>
<span class="r-in"><span class="va">NAlst</span> <span class="op">&lt;-</span> <span class="va">xyext</span><span class="op">$</span><span class="va">NAlst</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Plot extracted values of national forest district</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">spxyext</span><span class="op">[</span><span class="st">"DISTRICTNU"</span><span class="op">]</span><span class="op">)</span></span>
<span class="r-plt img"><img src="spExtractPoly-1.png" alt="" width="700" height="433"></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Tracey Frescino, Gretchen Moisen, Paul Patterson, Chris Toney, Grayson White.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

      </footer></div>

  


  

  </body></html>

