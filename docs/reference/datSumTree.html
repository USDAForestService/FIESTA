<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Data - Aggregates numeric tree data to the plot or condition-level. — datSumTree • FIESTA</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Data - Aggregates numeric tree data to the plot or condition-level. — datSumTree"><meta property="og:description" content="Aggregates numeric tree-level data (e.g., VOLCFNET) to plot or condition,
including options for filtering tree data or extrapolating to plot acre by
multiplying by TPA."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">FIESTA</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">3.5.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/FIESTA_manual_mod_est.html">`FIESTA` Manual - Module Estimates</a>
    </li>
    <li>
      <a href="../articles/FIESTA_manual_mod_pop.html">`FIESTA` Manual - Population Data</a>
    </li>
    <li>
      <a href="../articles/FIESTA_tutorial_DB.html">FIESTA - Database Tools</a>
    </li>
    <li>
      <a href="../articles/FIESTA_tutorial_GB.html">FIESTA - Green-book Estimators</a>
    </li>
    <li>
      <a href="../articles/FIESTA_tutorial_MA.html">FIESTA - Model-Assisted Estimators</a>
    </li>
    <li>
      <a href="../articles/FIESTA_tutorial_PB.html">FIESTA - Photo-Based Module</a>
    </li>
    <li>
      <a href="../articles/FIESTA_tutorial_SA.html">FIESTA - Small Area Estimators</a>
    </li>
    <li>
      <a href="../articles/FIESTA_tutorial_dat.html">FIESTA - Data Tools</a>
    </li>
    <li>
      <a href="../articles/FIESTA_tutorial_sp.html">FIESTA - Spatial Tools</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Data - Aggregates numeric tree data to the plot or condition-level.</h1>
    
    <div class="hidden name"><code>datSumTree.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Aggregates numeric tree-level data (e.g., VOLCFNET) to plot or condition,
including options for filtering tree data or extrapolating to plot acre by
multiplying by TPA.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">datSumTree</span><span class="op">(</span></span>
<span>  tree <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  seed <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  cond <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  datsource <span class="op">=</span> <span class="st">"obj"</span>,</span>
<span>  data_dsn <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  plt <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  plt_dsn <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  tuniqueid <span class="op">=</span> <span class="st">"PLT_CN"</span>,</span>
<span>  cuniqueid <span class="op">=</span> <span class="st">"PLT_CN"</span>,</span>
<span>  puniqueid <span class="op">=</span> <span class="st">"CN"</span>,</span>
<span>  bycond <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  condid <span class="op">=</span> <span class="st">"CONDID"</span>,</span>
<span>  bysubp <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  subpid <span class="op">=</span> <span class="st">"SUBP"</span>,</span>
<span>  tsumvarlst <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  tsumvarnmlst <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  TPA <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  tfun <span class="op">=</span> <span class="va">sum</span>,</span>
<span>  ACI <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  tfilter <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  addseed <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  lbs2tons <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  metric <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  getadjplot <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  adjtree <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  adjvar <span class="op">=</span> <span class="st">"tadjfac"</span>,</span>
<span>  adjTPA <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  NAto0 <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  tround <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  checkNA <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  returnDT <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  savedata <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  savedata_opts <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  gui <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>tree</dt>
<dd><p>Dataframe or comma-delimited file (*.csv). The tree-level table.</p></dd>


<dt>seed</dt>
<dd><p>Dataframe or comma-delimited file (*.csv). The seedling table.</p></dd>


<dt>cond</dt>
<dd><p>Dataframe or comma-delimited file (*.csv). Condition-level table
to join the aggregated tree data to, if bycond=TRUE. This table also may be
used for condition proportion or strata variables used if adjcond or
adjstrata = TRUE (See details below).  This table is optional.</p></dd>


<dt>datsource</dt>
<dd><p>String. Source of data ('obj', 'csv', 'sqlite', 'gdb').</p></dd>


<dt>data_dsn</dt>
<dd><p>String. If datsource='sqlite', the name of SQLite database
(*.sqlite).</p></dd>


<dt>plt</dt>
<dd><p>Dataframe, comma-delimited file (*.csv), or shapefile (*.shp).
Plot-level table to join the aggregated tree data to, if bycond=FALSE. This
table is optional.</p></dd>


<dt>plt_dsn</dt>
<dd><p>String. The data source name (dsn; i.e., folder or database
name) of plt. The dsn varies by driver. See gdal OGR vector formats
(https://www.gdal.org/ogr_formats.html). Optional.</p></dd>


<dt>tuniqueid</dt>
<dd><p>String. Unique identifier of plt in tree table.</p></dd>


<dt>cuniqueid</dt>
<dd><p>String. Unique identifier of plt in cond table if cond is
NOT NULL.</p></dd>


<dt>puniqueid</dt>
<dd><p>String. Unique identifier of plt table if plt is NOT NULL.</p></dd>


<dt>bycond</dt>
<dd><p>Logical. If TRUE, the data are aggregated to the condition
level (by: cuniqueid, condid). If FALSE, the data are aggregated to the plot
level (by: puniqueid).</p></dd>


<dt>condid</dt>
<dd><p>String. Unique identifier for conditions.</p></dd>


<dt>bysubp</dt>
<dd><p>Logical. If TRUE, data are aggregated to the subplot level.</p></dd>


<dt>subpid</dt>
<dd><p>String. Unique identifier of each subplot.</p></dd>


<dt>tsumvarlst</dt>
<dd><p>String (vector). Tree-level variable(s) to aggregate
(e.g., "TPA_UNADJ", "BA"). Use tsumvar="PLT_CN" (tfun=sum) for summed tree
count.</p></dd>


<dt>tsumvarnmlst</dt>
<dd><p>String (vector). Name of the tree-level variable(s) to
aggregate (e.g., "TPALIVE", "BALIVE"). This list must have the same number
of variables as tsumvarlst and be in respective order. If NULL, the default
names will be tsumvar'_tfun' (e.g., "TPA_UNADJ_SUM", "BA_SUM").</p></dd>


<dt>TPA</dt>
<dd><p>Logical. If TRUE, tsumvarlst variable(s) are multiplied by the
respective trees-per-acre variable (see details) to get per-acre
measurements.</p></dd>


<dt>tfun</dt>
<dd><p>Function. The name of the function to use to aggregate the data
(e.g., sum, mean, max).</p></dd>


<dt>ACI</dt>
<dd><p>Logical. If TRUE, if ACI (All Condition Inventory) plots exist,
any trees on these plots will be included in summary. If FALSE, you must
include condition table.</p></dd>


<dt>tfilter</dt>
<dd><p>String. Filter to subset the tree data before aggregating
(e.g., "STATUSCD == 1"). This must be in R syntax. If tfilter=NULL, user is
prompted.  Use tfilter="NONE" if no filters.</p></dd>


<dt>addseed</dt>
<dd><p>Logical. If TRUE, add seedling data to tree counts (if TPA
variable in tsumvarlst).</p></dd>


<dt>lbs2tons</dt>
<dd><p>Logical. If TRUE, converts biomass or carbon variables from
pounds to tons.</p></dd>


<dt>metric</dt>
<dd><p>Logical. If TRUE, converts response to metric units based on
FIESTA::ref_conversion, if any variable in tsumvarlst is in
FIESTAutils::ref_estvar.  Note: if TPA, TPA is converted to trees per hectare
(TPH: 1 / (1/ tpavar * 0.4046860)).</p></dd>


<dt>getadjplot</dt>
<dd><p>Logical. If TRUE, adjustments are calculated for
nonsampled conditions on plot.</p></dd>


<dt>adjtree</dt>
<dd><p>Logical. If TRUE, trees are individually adjusted by
adjustment factors.  Adjustment factors must be included in tree table (see
adjvar).</p></dd>


<dt>adjvar</dt>
<dd><p>String. If adjtree=TRUE, the name of the variable to use for
multiplying by adjustment (e.g., tadjfac).</p></dd>


<dt>adjTPA</dt>
<dd><p>Numeric. A tree-per-acre adjustment. Use for DESIGNCD=1
(annual inventory), if using less than 4 subplots. If using only 1 sublot
for estimate, adjTPA=4. The default is 1.</p></dd>


<dt>NAto0</dt>
<dd><p>Logical. If TRUE, convert NA values to 0.</p></dd>


<dt>tround</dt>
<dd><p>Number. The number of digits to round to. If NULL, default=6.</p></dd>


<dt>checkNA</dt>
<dd><p>Logical. If TRUE, checks if NA values exist in necessary
variables.</p></dd>


<dt>returnDT</dt>
<dd><p>Logical. If TRUE, returns data.table object(s). If FALSE,
returns data.frame object(s).</p></dd>


<dt>savedata</dt>
<dd><p>Logical. If TRUE, saves data to outfolder.</p></dd>


<dt>savedata_opts</dt>
<dd><p>List. See help(savedata_options()) for a list
of options. Only used when savedata = TRUE. If out_layer = NULL,
default = 'treesum'.</p></dd>


<dt>gui</dt>
<dd><p>Logical. If gui, user is prompted for parameters.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>A list of the following items:</p>
<dl><dt>treedat</dt>
<dd><p>Data frame. Plot or
condition-level table with aggregated tree attributes.</p></dd>
 <dt>sumvars</dt>
<dd><p>String vector. Name(s) of the output aggregated tree attributes.</p></dd>


</dl><p>If savedata=TRUE<br> - treedat will be saved to the outfolder. <br> - a text
file of input parameters is saved to outfolder
('outfn'_parameters_'date'.txt).</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>If variable = NULL, then it will prompt user for input.</p>
<p>Dependent external functions: datFilter Dependent internal functions:
addcommas, fileexistsnm, getadjfactor</p>
<p>For adjcond (bycond=FALSE): <br> If you want to get trees-per-acre
information aggregated to plot or condition level, you need to include a TPA
variable in tree table. <br> For tsumvars = GROWCFGS, GROWBFSL, GROWCFAL,
FGROWCFGS, FGROWBFSL, or FGROWCFAL, you must have TPAGROW_UNADJ <br> For
tsumvars = MORTCFGS, MORTBFSL, MORTCFAL, FMORTCFGS, FMORTBFSL, or FMORTCFAL,
you must have TPAMORT_UNADJ <br> For tsumvars = REMVCFGS, REMVBFSL, REMVCFAL,
FREMVCFGS, FREMVBFSL, or FREMVCFAL, you must have TPAREMV_UNADJ <br></p>
<p>If you want to adjust plot-level information by condition proportions
(adjplot), you need to include CONDID &amp; CONDPROP_UNADJ in cond or tree table
and COND_STATUS_CD and FORTYPCD if adjplot="FVS". For adjplot="WEIGHTED" -
each tree is weighted (or multiplied) by the condition proportions
(CONDPROP_UNADJ). For adjplot="FVS", each tree is weighted (or multiplied)
by the sum of the condition proportions (CONDPROP_UNADJ) that are forested
and not nonstocked (COND_STATUS_CD = 1 and FORTYPCD != 999).  <br></p>
    </div>
    <div id="note">
    <h2>Note</h2>
    <p>If a dat table is provided, the aggregated tree data will be merged to
table and NULL values will be output as 0.</p>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Tracey S. Frescino</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Aggregate LIVE_CANOPY_CVR_PCT to plot, weighted by CONDPROP_UNADJ</span></span></span>
<span class="r-in"><span><span class="va">treesum</span> <span class="op">&lt;-</span> <span class="fu">datSumTree</span><span class="op">(</span>tree <span class="op">=</span> <span class="fu">FIESTA</span><span class="fu">::</span><span class="va"><a href="WYtree.html">WYtree</a></span>,</span></span>
<span class="r-in"><span>                      tsumvarlst <span class="op">=</span> <span class="st">"TPA_UNADJ"</span><span class="op">)</span><span class="op">$</span><span class="va">treedat</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>COND_STATUS_CD not in table, assuming forested plots with no ACI plots</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Check results</span></span></span>
<span class="r-in"><span><span class="va">treesum</span><span class="op">[</span><span class="va">treesum</span><span class="op">$</span><span class="va">PLT_CN</span> <span class="op">==</span> <span class="fl">40404737010690</span>,<span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            PLT_CN COUNT_TPA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1: 40404737010690  12.03609</span>
<span class="r-in"><span><span class="fu">FIESTA</span><span class="fu">::</span><span class="va"><a href="WYtree.html">WYtree</a></span><span class="op">[</span><span class="fu">FIESTA</span><span class="fu">::</span><span class="va"><a href="WYtree.html">WYtree</a></span><span class="op">$</span><span class="va">PLT_CN</span> <span class="op">==</span> <span class="fl">40404737010690</span>,<span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               PLT_CN CONDID SUBP TREE STATUSCD SPCD SPGRPCD DIA HT TREECLCD</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17431 40404737010690      2    3    1        2  746      44  NA NA       NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17432 40404737010690      2    3    2        2  746      44  NA NA       NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17433 40404737010690      2    3    3        1  746      44 5.9 24        2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17434 40404737010690      2    3    6        1  746      44 6.3 22        3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17435 40404737010690      2    3    7        2  746      44  NA NA       NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17436 40404737010690      2    3    8        2  746      44  NA NA       NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       AGENTCD STANDING_DEAD_CD VOLCFNET VOLCFGRS VOLBFNET TPA_UNADJ DRYBIO_AG</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17431      70                0       NA       NA       NA        NA   0.00000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17432      70                0       NA       NA       NA        NA   0.00000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17433      NA               NA 0.852096 0.926191       NA  6.018046  34.61910</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17434      NA               NA 0.807224 1.009030       NA  6.018046  32.16685</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17435      70                0       NA       NA       NA        NA   0.00000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17436      70                0       NA       NA       NA        NA   0.00000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       CARBON_AG        BA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17431        NA        NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17432        NA        NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17433  17.30955 0.1898537</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17434  16.08343 0.2164693</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17435        NA        NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17436        NA        NA</span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Tracey Frescino, Gretchen Moisen, Paul Patterson, Chris Toney, Grayson White.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer></div>

  


  

  </body></html>

