<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Database - Gets stratification information from FIA database. — DBgetStrata • FIESTA</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Database - Gets stratification information from FIA database. — DBgetStrata"><meta property="og:description" content="Gets strata information from FIA's Oracle database or FIA DataMart,
including: (1) strata and estimation unit assignment per plot; (2) total
area by estimation unit; (3) pixel counts and number plots by
strata/estimation unit. Include a data frame of plots, states, or evaluation
information."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">FIESTA</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">3.5.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/FIESTA_manual_mod_est.html">`FIESTA` Manual - Module Estimates</a>
    </li>
    <li>
      <a href="../articles/FIESTA_manual_mod_pop.html">`FIESTA` Manual - Population Data</a>
    </li>
    <li>
      <a href="../articles/FIESTA_tutorial_DB.html">FIESTA - Database Tools</a>
    </li>
    <li>
      <a href="../articles/FIESTA_tutorial_GB.html">FIESTA - Green-book Estimators</a>
    </li>
    <li>
      <a href="../articles/FIESTA_tutorial_MA.html">FIESTA - Model-Assisted Estimators</a>
    </li>
    <li>
      <a href="../articles/FIESTA_tutorial_PB.html">FIESTA - Photo-Based Module</a>
    </li>
    <li>
      <a href="../articles/FIESTA_tutorial_SA.html">FIESTA - Small Area Estimators</a>
    </li>
    <li>
      <a href="../articles/FIESTA_tutorial_dat.html">FIESTA - Data Tools</a>
    </li>
    <li>
      <a href="../articles/FIESTA_tutorial_sp.html">FIESTA - Spatial Tools</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Database - Gets stratification information from FIA database.</h1>
    
    <div class="hidden name"><code>DBgetStrata.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Gets strata information from FIA's Oracle database or FIA DataMart,
including: (1) strata and estimation unit assignment per plot; (2) total
area by estimation unit; (3) pixel counts and number plots by
strata/estimation unit. Include a data frame of plots, states, or evaluation
information.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">DBgetStrata</span><span class="op">(</span></span>
<span>  dat <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  uniqueid <span class="op">=</span> <span class="st">"CN"</span>,</span>
<span>  datsource <span class="op">=</span> <span class="st">"datamart"</span>,</span>
<span>  data_dsn <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  states <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  eval_opts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/FIESTAutils/man/eval_options.html" class="external-link">eval_options</a></span><span class="op">(</span>Cur <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  savedata <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  getassgn <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  pop_plot_stratum_assgn <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  savedata_opts <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  dbconn <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  dbconnopen <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  evalInfo <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>dat</dt>
<dd><p>Data frame, comma-delimited file (*.csv), or shapefile (*.shp).
The strata value is merged to this table and returned as a data frame. See
details for necessary variables.</p></dd>


<dt>uniqueid</dt>
<dd><p>String. The unique plot identifier of dat (e.g., 'CN').</p></dd>


<dt>datsource</dt>
<dd><p>String. Source of data ('datamart', 'sqlite').</p></dd>


<dt>data_dsn</dt>
<dd><p>String. If datsource='sqlite', the name of SQLite database
(*.sqlite).</p></dd>


<dt>states</dt>
<dd><p>String or numeric vector. Name(s) (e.g., 'Arizona','New
Mexico') or code(s) (e.g., 4, 35) of states for strata if dat=NULL.</p></dd>


<dt>eval_opts</dt>
<dd><p>List of evaluation options for 'FIA' or 'custom'
evaluations to determine the set of data returned. See help(eval_options)
for a list of options.</p></dd>


<dt>savedata</dt>
<dd><p>Logical. If TRUE, writes output to outfolder.</p></dd>


<dt>getassgn</dt>
<dd><p>Logical. If TRUE, extracts plot assignments from
pop_plot_stratum_assgn table in database.</p></dd>


<dt>pop_plot_stratum_assgn</dt>
<dd><p>Data frame. The pop_plot_stratum_assgn for
state(s).</p></dd>


<dt>savedata_opts</dt>
<dd><p>List. See help(savedata_options()) for a list
of options. Only used when savedata = TRUE.</p></dd>


<dt>dbconn</dt>
<dd><p>Open database connection.</p></dd>


<dt>dbconnopen</dt>
<dd><p>Logical. If TRUE, the dbconn connection is not closed.</p></dd>


<dt>evalInfo</dt>
<dd><p>List. List object output from DBgetEvalid or DBgetXY 
FIESTA functions.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>FIAstrata - a list of the following objects:</p>
<dl><dt>pltassgn</dt>
<dd><p>Data
frame. Plot-level strata/estimation unit assignment.  If dat is not NULL,
strata/estimation unit variables are appended to dat.</p></dd>
 <dt>pltassgnid</dt>
<dd><p>String. Name of unique identifier of plot in pltassgn.</p></dd>
 <dt>unitarea</dt>
<dd><p>Data frame. Total acres by estimation unit.</p></dd>
 <dt>unitvar</dt>
<dd><p>String. Name
of the estimation unit variable (ESTN_UNIT).</p></dd>
 <dt>areavar</dt>
<dd><p>String. Name
of the acre variable (ACRES).</p></dd>
 <dt>stratalut</dt>
<dd><p>Data frame. Strata look-up
table with summarized pixel counts (P1POINTCNT) by strata/estimation unit.</p></dd>

<dt>strvar</dt>
<dd><p>String. Name of the strata variable (STRATA).</p></dd>

<dt>strwtvar</dt>
<dd><p>String. Name of the strata weight variable (P1POINTCNT).</p></dd>

<dt>evalid</dt>
<dd><p>List. evalid by state.</p></dd>


</dl><p>Outputs to outfolder (if savedata=TRUE):</p><table class="table table"><tr><td></td><td>- CSV file of
pltassgn (*'date'.csv).</td></tr><tr><td></td><td>- CSV file of unitarea (*'date'.csv).</td></tr><tr><td></td><td>- CSV file of stratalut (*'date'.csv).</td></tr><tr><td></td><td>- If collapsed, a CSV
file of original classes and new collapsed classes.</td></tr></table></div>
    <div id="details">
    <h2>Details</h2>
    <p>Dependent packages: DBI, rgdal</p>
<p>The following variables must be present in dat: STATECD, UNITCD, INVYR, a
uniqueid (ex. "PLT_CN"), and PLOT_STATUS_CD (if nonsampled plots in
dataset).</p>
<p>FIADB TABLES USED:</p><table class="table table"><tr><td></td><td>FS_FIADB.SURVEY</td><td>To get latest
inventory year.</td></tr><tr><td></td><td>FS_FIADB.POP_EVAL</td><td>To get EVALID and EVALID
years.</td></tr><tr><td></td><td>FS_FIADB.POP_ESTN_UNIT</td><td>To get total area by estimation
unit (AREATOT_EU-includes water).</td></tr><tr><td></td><td>FS_FIADB.POP_STRATUM</td><td>To get
pixel counts by stratum and estimation unit.</td></tr><tr><td></td><td>FS_FIADB.POP_PLOT_STRATUM_ASSGN</td><td>To get estimation unit &amp; stratum
assignment for each plot.</td></tr></table><p>Area by estimation unit includes total area for all plots (evaltype="all").</p>
    </div>
    <div id="note">
    <h2>Note</h2>
    <p>Steps used in data extraction:</p>
<ol><li><p>Get EVALID and EVALID years by state - DBgetEvalid().</p></li>
<li><p>unitarea: get total area by estimation unit for EVALID
(POP_ESTN_UNIT).</p></li>
<li><p>stratalut: get pixel counts by estimation unit and
stratum for EVALID (POP_STRATUM).</p></li>
<li><p>pltassgn: get estimation unit and
stratum assignment for each plot for EVALID.  (POP_PLOT_STRATUM_ASSGN).</p></li>
<li><p>If dat is not NULL, merge pltassgn assignment to dat.</p></li>
<li><p>Merge
number of plots to stratalut</p></li>
<li><p>Check for only 1 MEASYEAR or 1 INVYR and
number of plots by strata/estimation unit.  If less than minimumnum plots
per strata/estimation unit collapse using the following algorithm.</p></li>
</ol><p>Strata collapsing: <br> If there are less than minplotnum (10) plots in the
smallest strata of the estimation unit, these plots are grouped with the
larger strata in the same estimation unit and defined as the highest strata
value. If, after grouping, there are still less than minplotnum, all of
these plots are combined with the corresponding strata of the estimation
unit above.  If there are no records above, then they are combined with the
estimation unit below.  The process repeats, grouping the strata to the
highest strata value if necessary.  All grouping is restrained within survey
units (UNITCD).</p>
<p>More than one evaluation: <br> If attributing a table of plots and there are
plots that have been visited more than once, all plots are assigned an
estimation unit and strata value, but the area and strata proportions are
from the most current evaluation for the dataset. The plots outside the most
current evaluation are attributes with values from the next most current
evaluation occurring in the database.</p>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Tracey S. Frescino</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co"># Get strata for the most current evaluation of a state (ex. Wyoming)</span></span></span>
<span class="r-in"><span><span class="va">WYstrat1</span> <span class="op">&lt;-</span> <span class="fu">DBgetStrata</span><span class="op">(</span>states <span class="op">=</span> <span class="st">"Wyoming"</span>,</span></span>
<span class="r-in"><span>                        eval_opts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Cur <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">WYstrat1</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">WYstrat1</span><span class="op">$</span><span class="va">pltassgn</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">WYstrat1</span><span class="op">$</span><span class="va">unitarea</span></span></span>
<span class="r-in"><span><span class="va">WYstrat1</span><span class="op">$</span><span class="va">unitvar</span></span></span>
<span class="r-in"><span><span class="va">WYstrat1</span><span class="op">$</span><span class="va">areavar</span></span></span>
<span class="r-in"><span><span class="va">WYstrat1</span><span class="op">$</span><span class="va">strvar</span></span></span>
<span class="r-in"><span><span class="va">WYstrat1</span><span class="op">$</span><span class="va">evalid</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Get strata information for a specific set of plots</span></span></span>
<span class="r-in"><span><span class="va">WYstrat4</span> <span class="op">&lt;-</span> <span class="fu">DBgetStrata</span><span class="op">(</span>dat <span class="op">=</span> <span class="va">WYplt</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">WYstrat4</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">WYstrat4</span><span class="op">$</span><span class="va">pltassgn</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">WYstrat4</span><span class="op">$</span><span class="va">unitarea</span></span></span>
<span class="r-in"><span><span class="va">WYstrat4</span><span class="op">$</span><span class="va">evalid</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Tracey Frescino, Gretchen Moisen, Paul Patterson, Chris Toney, Grayson White.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer></div>

  


  

  </body></html>

