---
title: "FIESTA - Green-book Estimators - custom"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{FIESTA - Green-book Estimators - custom}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---


## FIESTA Overview
The R package, FIESTA (Forest Inventory ESTimation and Analysis) is a research estimation tool for analysts that work with sample-based inventory data like that from the U.S. Department of Agriculture, Forest Service, Forest Inventory and Analysis (FIA) Program to accommodate: unique population boundaries, different evaluation time periods, customized stratification schemes, non-standard variance equations, integration of multi-scale remotely-sensed data and other ancillary information, and interaction with other modeling and estimation tools from CRAN R's library of packages. FIESTA contains a collection of functions that can access FIA databases, summarize and compile plot and spatial data, and generate estimates with associated sampling errors. 


Functions are organized by type or objective and are named with a corresponding prefix: 

**Core Functions**

* Database tools (DB) - functions for querying and extracting data from FIA's national database.
* Data tools (dat) - functions for summarizing and exploring FIA data.
* Spatial tools (sp) - functions for manipulating and summarizing spatial data.

**Estimation Modules (mod)**

* Green-Book (modGB) - functions for FIA's standard Green-Book estimators.
* Photo-Based (modPB) - functions for supplementary photo-based estimators.
* Small Area (modSA) - functions for integration with available small area estimators (SAE).
* Model-Assisted (modMA) - functions for integration with available Model-Assisted estimators.

**Analysis Tools**

* Analysis tools (an) - wrapper functions for steam-lining estimation processes.



### Green-Book (GB) module overview
FIESTA's Green-Book (GB) module calculates population estimates and their sampling errors based on Bechtold and Patterson's (2005), 'Green-Book' for FIA's nationally-consistent, systematic annual sample design, chapter 4 (Scott et al. 2005). FIA's sample design is based on 2 phases: the first phase uses remotely-sensed data to stratify the land area to increase precision of estimates; while the 2nd phase obtains photo and ground observations and measurements for a suite of information across a hexagonal grid, each approximately 6000 acres in size. The associated estimators and variance estimators are used for area and tree attribute totals with the assumption of a simple random, stratified design and double sampling for stratification. Adjustment factors are calculated by estimation unit and strata to account for nonsampled (nonresponse) conditions.   

FIESTA includes non-ratio estimators for area and tree estimates by domain and ratio-of-means estimators for per-acre and per-tree estimates within domain. In addition, FIESTA adjusts for nonsampled conditions, supports post-stratification for reducing variance, and reports by estimation unit or a summed combination of estimation units. Output from the Green-Book module was tested and compared to output from FIA's publically-available online tool (EVALIDator - https://apps.fs.usda.gov/Evalidator/evalidator.jsp) for state-level population estimates and associated sampling errors generated from the FIA Database (FIADB).


### Objective of tutorial
The main objective of this tutorial is to demonstrate how to use FIESTA for generating estimates using estimators from FIA's 'Green Book'. The following examples are for generating estimates and estimated variances using standard FIA Evaluation plot data from FIA's National database, with custom Estimation unit and Stratification information. The examples use data from three inventory years of field measurements in the state of Wyoming, from FIADB_1.7.2.00, last updated June 20, 2018, downloaded on June 25, 2018 and stored as internal data objects in FIESTA. Estimates can be compared with EVALIDator estimates, using the 2013 evaluation (https://apps.fs.usda.gov/Evalidator/evalidator.jsp).


## Example data - Wyoming (WY), Inventory Years 2011-2013

Data Frame | Description
-----------| --------------------------------------------------------------------------------
WYplt      | WY plot-level data
WYcond     | WY condition-level data
WYtree     | WY tree-level data

External data            | Description
-------------------------| ------------------------------------------------------------------
WYbighorn_adminbnd.shp   | Polygon shapefile of WY Bighorn National Forest Administrative boundary*
WYbighorn_districtbnd.shp| Polygon shapefile of WY Bighorn National Forest District boundaries**
WYbighorn_forest_nonforest_250m.tif| GeoTIFF raster of predicted forest/nonforest (1/0)*** 
WYbighorn_dem_250m.img   | Erdas Imagine raster of elevation change, in meters****

*USDA Forest Service, Automated Lands Program (ALP). 2018. S_USA.AdministrativeForest (http://data.fs.usda.gov/geodata/edw). Description: An area encompassing all the National Forest System lands administered by an administrative unit. The area encompasses private lands, other governmental agency lands, and may contain National Forest System lands within the proclaimed boundaries of another administrative unit. All National Forest System lands fall within one and only one Administrative Forest Area.

**USDA Forest Service, Automated Lands Program (ALP). 2018. S_USA.RangerDistrict (http://data.fs.usda.gov/geodata/edw). Description: A depiction of the boundary that encompasses a Ranger District.

***Based on 250m resolution, Moderate Resolution Imaging Spectroradiometer (MODIS), classified map, reclassified from 3 to 2 classes: 1:forest; 2:nonforest. Projected in Albers Conical Equal Area, Datum NAD27 (Ruefenacht et al. 2008).

****USGS National Elevation Dataset (NED), resampled from 30m resolution to 250m. Projected in Albers Conical Equal Area, Datum NAD27 (U.S. Geological Survey 2017).



FUNCTION  | DESCRIPTION
-------------- | ---------------------------------------------------------------
[spGetStrata()](#spGetStrata) | Strata/estimation unit information for customized estimates.
[modGBpop()](#modGBpop)| Compile population data for GB estimation.
[modGBarea()](#modGBarea)| Green-book estimates of area using customized strata/estimation unit.
[modGBtree()](#modGBtree)| Green-book estimates of trees using customized strata/estimation unit.
[modGBratio()](#modGBratio)| Green-book ratio estimates of trees using customized strata/estimation unit.


### EXAMPLES

Set up for examples
```{r}
# Load library
library(FIESTA)

dir.create("FIESTA")
dir.create(paste0(getwd(),"/FIESTA", "/outfolder"))
outfolder <- paste0(getwd(),"/FIESTA", "/outfolder")

# File names for external spatial data
WYbhfn <- system.file("extdata", "sp_data/WYbighorn_adminbnd.shp", package="FIESTA")
WYbhdistfn <- system.file("extdata", "sp_data/WYbighorn_districtbnd.shp", package="FIESTA")
WYbhdist.att <- "DISTRICTNA"

fornffn <- system.file("extdata", "sp_data/WYbighorn_forest_nonforest_250m.tif", package="FIESTA")
demfn <- system.file("extdata", "sp_data/WYbighorn_dem_250m.img", package="FIESTA")


```



### Auxiliary Data

<a name="spGetStrata"/>spGetStrata()

Post-stratification is used to reduce variance in population estimates by partitioning the population into homogenous classes (strata). The strata proportions (i.e., weights) must be either known or estimated. Remotely-sensed spatial layers across the population provide this information and can be treated as known values in the variance equations. For estimation, we need to know the strata each plot location falls in, the proportion of all strata classes by each estimation unit within the population, and the total area of each estimation unit. 

In FIESTA, the plot assignments, strata proportions, and area are provided by the user and may be obtained through FIESTA or other means, given the proper format. 

The FIESTA *spGetStrata* function is a spatial wrapper function to facilitate extraction and summary of given spatial data used for post-stratification. The function uses the FIESTA *spExtractPoly* and *spExtractRast* functions to extract values from estimation unit (i.e., polygon) and strata values (i.e., raster) to plot locations, respectively, and other internal spatial function to calculate pixel counts and area by estimation unit. If a polygon strata layer is given, the FIESTA *spPoly2Rast* function converts the polygon layer to raster before calculating strata weights. 


Bighorn National Forest
```{r}

# Get estimation unit and strata information for Bighorn National Forest.
stratdat.bh <- spGetStrata(
      xyplt=WYplt,
      uniqueid="CN", 
      xvar="LON_PUBLIC", 
      yvar="LAT_PUBLIC", 
      prj="longlat", 
      datum="NAD83", 
      unit_layer=WYbhfn, 
      strat_layer=fornffn
      )

## Get names of output list components
names(stratdat.bh)

## Extract components of output list
pltassgn.bh <- stratdat.bh$pltassgn
unitarea.bh <- stratdat.bh$unitarea
stratalut.bh <- stratdat.bh$stratalut
strvar.bh <- stratdat.bh$strvar
unitvar.bh <- stratdat.bh$unitvar
areavar.bh <- stratdat.bh$areavar

## Plot assignment of strata and estimation unit (ONEUNIT, STRATUMCD)
head(pltassgn.bh)

## Area by estimation unit
unitarea.bh

## Pixel counts and strata weights (strwt) by strata and estimation unit
stratalut.bh

## Variable names
unitvar.bh        # Estimation unit variable
strvar.bh         # Strata variable
areavar.bh        # Area variable

```


Bighorn National Forest Districts
```{r}

# Get estimation unit and strata information for Bighorn National Forest Districts
stratdat.bhdist <- spGetStrata(
      xyplt=WYplt,
      uniqueid="CN", 
      xvar="LON_PUBLIC", 
      yvar="LAT_PUBLIC", 
      prj="longlat", 
      datum="NAD83", 
      unit_layer=WYbhdistfn, 
      unitvar="DISTRICTNA",
      strat_layer=fornffn
      )

## Get names of output list components
names(stratdat.bhdist)

## Extract components of output list
pltassgn.bhdist <- stratdat.bhdist$pltassgn
unitarea.bhdist <- stratdat.bhdist$unitarea
stratalut.bhdist <- stratdat.bhdist$stratalut
strvar.bhdist <- stratdat.bhdist$strvar
unitvar.bhdist <- stratdat.bhdist$unitvar
areavar.bhdist <- stratdat.bhdist$areavar


## Plot assignment of strata and estimation unit (DISTRICTNA, STRATUMCD)
head(pltassgn.bhdist)

## Area by estimation units (Districts)
unitarea.bhdist

## Pixel counts and strata weights (strwt) by strata and estimation unit
stratalut.bhdist


## Variable names
unitvar.bhdist        # Estimation unit variable
strvar.bhdist         # Strata variable
areavar.bhdist        # Area variable

```


<a name="modGBpop"></a>

### modGBpop()

FIESTA's population functions (mod*pop) check input data and perform population-level calculations, such as: summing number of sampled plots; adjusting for partial nonresponse; and standardizing auxiliary data. These functions are specific to each FIESTA module and are run prior to or within a module for any population of interest. 

For FIESTA's GB Module, the modGBpop function calculates and outputs: number of plots, adjustment factors, and an expansion factor by strata. The outputs are similar to data found in FIADB's pop_stratum table. The output from modGBpop can be used for one or more estimates from modGBarea, modGBtree, or modGBratio functions.

In this example, we use the sample WY plot data (2013 Evaluation) in FIESTA and output from spGetStrata to generate population data for the Bighorn National Forest and for the Bighorn National Forest Districts.

If the FIESTA spGetStrata function is used to obtain stratification data, the output list object can be input directly into modGBpop through the GBstratdat parameter. If other methods are used, the data are input through individual parameters.


Bighorn National Forest
```{r}

## Population data for Bighorn National Forest

## Using output list from spGetStrata()
GBpopdat.bh <- modGBpop(
  popTabs = list(plt=WYplt, 
                cond=WYcond, 
                tree=WYtree, 
                seed=WYseed),
  stratdat=stratdat.bh)

## Get names of output list components
names(GBpopdat.bh)

## Using output as individual parameter inputs
GBpopdat.bh <- modGBpop(
  popTabs = list(
    plt=WYplt, 
    cond=WYcond, 
    tree=WYtree, 
    seed=WYseed
  ),
  pltassgn=pltassgn.bh, 
  pltassgnid="CN", 
  unitvar=unitvar.bh, 
  unitarea=unitarea.bh, 
  areavar=areavar.bh, 
  stratalut=stratalut.bh, 
  strvar=strvar.bh, 
  strata_opts = list(getwt=FALSE))

## Get names of output list components
names(GBpopdat.bh)

## Condition information with adjusted condition proportions for area
head(GBpopdat.bh$condx)

## Tree information with tree-level adjustment factors
head(GBpopdat.bh$treex)

## Seedling information with adjustment factors
head(GBpopdat.bh$seedx)

## Strata-level information, including number of plots by strata and strata-level adjustment factors
GBpopdat.bh$stratalut


```


Bighorn National Forest Districts
```{r}

## Population data for Bighorn National Forest Districts

## Using output list from spGetStrata()
GBpopdat.bhdist <- modGBpop(
  popTabs = list(
      plt=WYplt, 
      cond=WYcond, 
      tree=WYtree, 
      seed=WYseed 
  ),
  stratdat=stratdat.bhdist)

## Get names of output list components
names(GBpopdat.bhdist)


GBpopdat.bhdist <- modGBpop(
  popTabs = list(
    plt=WYplt, 
    cond=WYcond, 
    tree=WYtree, 
    seed=WYtree
  ),
  pltassgn=pltassgn.bhdist, 
  pltassgnid="CN", 
  unitvar=unitvar.bhdist, 
  unitarea=unitarea.bhdist, 
  areavar=areavar.bhdist, 
  stratalut=stratalut.bhdist, 
  strvar=strvar.bhdist, 
  strata_opts = list(getwt=FALSE)
  )

## Get names of output list components
names(GBpopdat.bhdist)
 
## Condition information with adjusted condition proportions for area
head(GBpopdat.bhdist$condx)

## Tree information with tree-level adjustment factors
head(GBpopdat.bhdist$treex)

## Seedling information with adjustment factors
head(GBpopdat.bhdist$seedx)

## Strata-level information, including number of plots by strata and strata-level adjustment factors
GBpopdat.bhdist$stratalut


```


<a name="modGBarea"></a>

### modGBarea()

FIESTA's modGBarea function generates acre estimates by domain (e.g., Forest type). Calculations are based on Scott et al. 2015 ('Green-Book') for mapped forest inventory plots. The non-ratio estimator for estimating area by stratum and domain is used. Plots that are totally nonsampled are excluded from the estimation dataset. Next, an adjustment factor is calculated by strata to adjust for nonsampled (nonresponse) conditions that have proportion less than 1. The attribute is the proportion of the plot which is divided by the adjustment factor, and averaged by stratum. Strata means are combined using the strata weights and then expanded to acres using the total land area in the population.

If there are more than one estimation unit (i.e., subpopulation) within the population, estimates are generated by estimation unit. If sumunits=TRUE, the estimates and percent standard errors returned are a sum combination of all estimation units. If rawdata=TRUE, the raw data returned will include estimates by estimation unit.  

Parameters defined in the following examples are organized by category: population data (pop); estimation information (est); and output details (out).


Bighorn National Forest
```{r}

## Area estimates for Bighorn National Forest

## By Bighorn National Forest ##
# Area by forest type and stand-size class for Bighorn National Forest
area.bh <- modGBarea(
        GBpopdat=GBpopdat.bh, 
        # cond=WYcond, 
        rowvar="FORTYPCD", 
        colvar="STDSZCD", 
        table_opts = list(row.FIAname=TRUE, 
                          col.FIAname=TRUE),
        returntitle=TRUE, 
        title_opts = list(title.ref="Bighorn National Forest")
        )

## Estimates and percent sampling error
area.bh$est
area.bh$pse

## List of raw data
area.bh.raw <- area.bh$raw
names(area.bh.raw)

## Raw data for estimation unit
area.bh$raw$unit_totest

## Raw data for row estimates
area.bh$raw$unit_rowest

## Raw data for column estimates
area.bh$raw$unit_colest

## Raw data for group (cell) - level estimates
area.bh$raw$unit_grpest

## List of titles
area.bh$titlelst

```


Bighorn National Forest Districts
```{r}

## Area estimates for Bighorn National Forest Districts

# Area by forest type group and primary disturbance class for Bighorn National Forest
# Save data to outfolder, with prefix attached to file names
area.bhdist <- modGBarea(
      GBpopdat=GBpopdat.bhdist, 
      rowvar="FORTYPGRPCD", 
      colvar="DSTRBCD1",
      table_opts = list(row.FIAname=TRUE, 
                        col.FIAname=TRUE),
      returntitle=TRUE, 
      title_opts = list(title.ref="Bighorn National Forest"),
      savedata=TRUE, 
      savedata_opts = list(outfn.pre="bhdist")
      )

## Estimates and percent sampling error
area.bhdist$est
area.bhdist$pse

## List of raw data
area.bhdist.raw <- area.bhdist$raw
names(area.bhdist.raw)

## Raw data for estimation unit
area.bhdist$raw$unit_totest

## Raw data for row estimates
area.bhdist$raw$unit_rowest

## Raw data for column estimates
area.bhdist$raw$unit_colest

## Raw data for group (cell) estimates
area.bhdist$raw$unit_grpest

## List of titles
area.bhdist$titlelst



## By Bighorn National Forest ##
# Area by road distance and reserved status for Bighorn National Forest
# Note: include percent standard error and estimates in same table.
area.bh2 <- modGBarea(
      GBpopdat=GBpopdat.bh, 
      rowvar="RDDISTCD", 
      colvar="RESERVCD", 
      table_opts = list(row.FIAname=TRUE, 
                        col.FIAname=TRUE,
                        allin1=TRUE),
      returntitle=TRUE, 
      title_opts = list(title.ref="Bighorn National Forest"))
area.bh2$est


```


<a name="modGBtree"></a>

### modGBtree

FIESTA's modGBtree function generates tree estimates by domain (e.g., Forest type) and/or tree domain (e.g., Species). Calculations are based on Scott et al. 2005 ('the green-book') for mapped forest inventory plots. The non-ratio estimator for estimating tree attributes by stratum and domain is used. Plots that are totally nonsampled are excluded from estimation dataset. Next, an adjustment factor is calculated by strata to adjust for nonsampled (nonresponse) conditions that have proportion less than 1. Attributes adjusted to a per-acre value are summed by plot, divided by the adjustment factor, and averaged by stratum. Strata means are combined using the strata weights and then expanded to using the total land area in the population. 

If there are more than one estimation unit (i.e., subpopulation) within the population, estimates are generated by estimation unit. If sumunits=TRUE, the estimates and percent standard errors returned are a sum combination of all estimation units. If rawdata=TRUE, the raw data returned will include estimates by estimation unit.  

Parameters defined in the following examples are organized by category: population data (pop); estimation information (est); and output details (out).


```{r}
## Tree estimates for Bighorn National Forest

# Live tree basal area by forest type for Bighorn National Forest
# Save data to outfolder
balive.bh <- modGBtree(
      GBpopdat=GBpopdat.bh, 
      tree=WYtree, 
      cond=WYcond,
      rowvar="FORTYPCD",
      row.FIAname=TRUE,  
      estvar="BA", 
      estvar.filter="STATUSCD==1",  
      rawdata=TRUE, 
      returntitle=TRUE, 
      title.ref="Bighorn National Forest", 
      savedata=TRUE, 
      outfolder=outfolder
      )

names(balive.bh)

## Estimates and percent sampling error
balive.bh$est

## List of raw data
balive.bh.raw <- balive.bh$raw
names(balive.bh.raw)

## Raw data for estimation unit
balive.bh$raw$unit_totest

## Raw data for row estimates
balive.bh$raw$unit_rowest

## List of titles
balive.bh$titlelst


```


```{r}

## Tree estimates for Bighorn National Forest Districts

## Live tree basal area by forest type for Bighorn National Forest districts
## Note: adding sumunits=TRUE, sums estimation units for final estimate, 
##    and includes unit-level and summed estimates in raw data.
balive.bhdist <- modGBtree(
      GBpopdat=GBpopdat.bhdist, 
      tree=WYtree, 
      cond=WYcond, 
      sumunits=TRUE, 
      rowvar="FORTYPCD", 
      row.FIAname=TRUE,  
      estvar="BA", 
      estvar.filter="STATUSCD==1", 
      rawdata=TRUE, 
      returntitle=TRUE,  
      title.ref="Bighorn National Forest", 
      stratcombine=FALSE
      )


names(balive.bhdist)

## Estimates and percent sampling error for total forest
balive.bhdist$est

## List of raw data
balive.bhdist.raw <- balive.bhdist$raw
names(balive.bhdist.raw)

## Raw data for total by estimation unit
balive.bhdist$raw$unit_totest

## Raw data for estimation unit
balive.bhdist$raw$totest

## Raw data for row estimates by estimation unit
balive.bhdist$raw$unit_rowest

## Raw data for total row estimates
balive.bhdist$raw$rowest

## List of titles
balive.bhdist$titlelst



## By Bighorn National Forest District ##
# Basal area of live trees by forest type by district for Bighorn National Forest
## Note: set sumunits=FALSE, to get estimates by district
balive.bhdist <- modGBtree(
      GBpopdat=GBpopdat.bhdist, 
      tree=WYtree, 
      cond=WYcond,  
      sumunits=FALSE, 
      rowvar="FORTYPCD", 
      row.FIAname=TRUE, 
      estvar="BA", 
      estvar.filter="STATUSCD==1", 
      rawdata=FALSE, 
      returntitle=TRUE, 
      title.ref="Bighorn National Forest"
      )
names(balive.bhdist)

## Estimates and percent sampling error by district
balive.bhdist$est
balive.bhdist$pse

## List of titles
balive.bhdist$titlelst



## By Bighorn National Forest ##
# Volume of dead trees by forest type and stand-size class for Bighorn National Forest
voldead.bh <- modGBtree(
      GBpopdat=GBpopdat.bh, 
      tree=WYtree, 
      cond=WYcond, 
      rowvar="FORTYPCD", 
      row.FIAname=TRUE, 
      colvar="STDSZCD", 
      col.FIAname=TRUE,
      estvar="VOLCFNET", 
      estvar.filter="STATUSCD == 2 & STANDING_DEAD_CD == 1", 
      rawdata=TRUE, 
      returntitle=TRUE, 
      title.ref="Bighorn National Forest"
      )
names(voldead.bh)

## Estimates and percent sampling error by district
voldead.bh$est
voldead.bh$pse

## List of raw data
voldead.bh.raw <- voldead.bh$raw
names(voldead.bh.raw)

## Raw data for estimation unit
voldead.bh$raw$unit_totest

## Raw data for row estimates
voldead.bh$raw$unit_rowest

## Raw data for column estimates
voldead.bh$raw$unit_colest

## Raw data for group (cell) estimates
head(voldead.bh$raw$unit_grpest)

## List of titles
titlelst <- voldead.bh$titlelst
titlelst


## Create barplot
datBarplot(
      voldead.bh$raw$unit_rowest, 
      xvar=titlelst$title.rowvar, 
      yvar="est"
      )

## Create fancier barplot
datBarplot(
      voldead.bh$raw$unit_rowest, 
      xvar=titlelst$title.rowvar, 
      yvar="est",
      errbars=TRUE, 
      sevar="est.se", 
      main=wraptitle(titlelst$title.row,75),
      ylabel=titlelst$title.yvar, 
      divideby="million"
      )


## By Bighorn National Forest ##
# Number of live trees by forest type for Bighorn National Forest
tpalive.bh <- modGBtree(GBpopdat=GBpopdat.bh, tree=WYtree, cond=WYcond,  
  rowvar="FORTYPCD", row.FIAname=TRUE, 
  estvar="TPA_UNADJ", estvar.filter="STATUSCD==1", rawdata=FALSE, returntitle=TRUE, 
  title.ref="Bighorn National Forest")
names(tpalive.bh)

## Estimates and percent sampling error
tpalive.bh$est


## By Bighorn National Forest ##
# Number of live trees (plus seedlings) by forest type for Bighorn National Forest
tpalive.seed.bh <- modGBtree(
      GBpopdat=GBpopdat.bh, 
      tree=WYtree, 
      cond=WYcond,  
      estseed = "add", 
      rowvar="FORTYPCD", 
      row.FIAname=TRUE, 
      estvar="TPA_UNADJ", 
      estvar.filter="STATUSCD==1", 
      rawdata=FALSE, 
      returntitle=TRUE, 
      title.ref="Bighorn National Forest"
      )
names(tpalive.seed.bh)

## Estimates and percent sampling error
tpalive.seed.bh$est


```



<a name="modGBratio"></a>

### modGBratio

FIESTA's modGBratio function generates per-acre and per-tree estimates by domain and/or tree domain by domain (e.g., Forest type) and/or tree domain (e.g., Species). Calculations are based on Scott et al. 2005 ('the green-book') for mapped forest inventory plots. The ratio estimator for estimating per-acre or per-tree by stratum and domain is used, referred to as Ratio of Means (ROM). 

If there are more than one estimation unit (i.e., subpopulation) within the population, estimates are generated by estimation unit. If sumunits=TRUE, the estimates and percent standard errors returned are a sum combination of all estimation units. If rawdata=TRUE, the raw data returned will include estimates by estimation unit.  

Parameters defined in the following examples are organized by category: population data (pop); estimation information (est); and output details (out).


Bighorn National Forest
```{r}

## Tree ratio estimates for Bighorn National Forest
## Volume per acre of live trees by forest type and stand-size class for Bighorn National Forest
volrat.bh <- modGBratio(
      GBpopdat=GBpopdat.bh, 
      tree=WYtree, 
      cond=WYcond, 
      rowvar="FORTYPCD", 
      row.FIAname=TRUE, 
      colvar="STDSZCD", 
      col.FIAname=TRUE, 
      estvarn="VOLCFNET", 
      estvarn.filter="STATUSCD==1", 
      rawdata=TRUE, 
      returntitle=TRUE, 
      title.ref="Bighorn National Forest"
      )
names(volrat.bh)

## Estimates and percent sampling error by district
volrat.bh$est
volrat.bh$pse


## List of raw data
volrat.bh.raw <- volrat.bh$raw
names(volrat.bh.raw)

## Raw data for estimation unit
volrat.bh$raw$unit_totest

## Raw data for row estimates
volrat.bh$raw$unit_rowest

## Raw data for column estimates
volrat.bh$raw$unit_colest

## Raw data for group (cell) estimates
head(volrat.bh$raw$unit_grpest)

## List of titles
volrat.bh$titlelst

	
## Tree ratio estimates for Bighorn National Forest districts

## Trees per acre by species and stand-size class for Bighorn National Forest by district
## Note: Change title of estimation unit to District
## Set sumunits=TRUE, to get estimates for total forest

spprat.bhdist <- modGBratio(
      GBpopdat=GBpopdat.bhdist, 
      tree=WYtree, 
      cond=WYcond,
      sumunits=TRUE, 
      rowvar="SPCD", 
      row.FIAname=TRUE, 
      colvar="STDSZCD", 
      col.FIAname=TRUE,
      estvarn="VOLCFNET", 
      estvarn.filter="STATUSCD==1", 
      rawdata=TRUE, 
      returntitle=TRUE, 
      title.ref="Bighorn National Forest"
      )
names(spprat.bhdist)

## Estimates and percent sampling error by district
spprat.bhdist$est
spprat.bhdist$pse


## List of raw data
spprat.bhdist.raw <- spprat.bhdist$raw
names(spprat.bhdist.raw)

## Raw data for estimation unit
spprat.bhdist$raw$unit_totest

## Raw data for row estimates
spprat.bhdist$raw$unit_rowest

## Raw data for column estimates
spprat.bhdist$raw$unit_colest

## Raw data for group (cell) estimates
head(spprat.bhdist$raw$unit_grpest)

## List of titles
spprat.bhdist$titlelst


## By Bighorn National Forest ##
## Add diameter classes
## Net volume per acre of live trees (at least 5 inches) by species group and diameter class
dat <- datLUTclass(
            x=GBpopdat.bh$treex, 
            xvar="DIA", 
            LUT=ref_diacl2in, 
            LUTclassnm="DIACL2IN")
GBpopdat.bh$treex <- dat$xLUT
LUT <- dat$LUT

sgrprat.bh <- modGBratio(
          GBpopdat=GBpopdat.bh, 
          landarea="FOREST", 
          estvarn="TPA_UNADJ", 
          estvarn.filter="STATUSCD==1", 
          rowvar="SPGRPCD", 
          colvar="DIACL2IN", 
          row.FIAname=TRUE, 
          sumunits=TRUE, 
          rawdata=TRUE
          )
sgrprat.bh$est
sgrprat.bh$pse

names(sgrprat.bh)
names(sgrprat.bh$raw)
head(sgrprat.bh$raw$grpest)


```

## References

Bechtold, William A.; Patterson, Paul L., Editors. 2005. The enhanced Forest Inventory and Analysis programâ€”national sampling design and estimation procedures. Gen. Tech. Rep. SRS-80. Asheville, NC: U.S. Department of Agriculture, Forest Service, Southern Research Station. 85 p.

Patterson, Paul L. 2012. Photo-based estimators for the Nevada photo-based inventory. Res. Pap. RMRS-RP-92. Fort Collins, CO: U.S. Department of Agriculture, Forest Service, Rocky Mountain Research Station. 14 p.

Ruefenacht, B.; Finco, M.V.; Nelson, M.D.; Czaplewski, R.; Helmer, E.H.; Blackard, J. A.; Holden, G.R.; Lister, A.J.; Salajanu, D.; Weyermann, D.; Winterberger, K. 2008. Conterminous U.S. and Alaska Forest Type Mapping Using Forest Inventory and Analysis Data.  Photogrammetric Engineering &amp; Remote 
Sensing Vol. 74, No. 11, November 2008, pp. 1379-1388.}

```{r, include = FALSE}
# deletes old outfolder from examples
unlink(substr(outfolder,
              1,
              nchar(outfolder)-10),
       recursive = TRUE)
```

