<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Tree Data Summaries • FIESTA</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Tree Data Summaries">
<meta name="description" content="Walk through a series of examples to learn how to use FIESTA utility functions to summarise FIA tree data.
">
<meta property="og:description" content="Walk through a series of examples to learn how to use FIESTA utility functions to summarise FIA tree data.
">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">FIESTA</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.6.4.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/FIESTA_tutorial_GB.html">Green-book Estimators</a></li>
    <li><a class="dropdown-item" href="../articles/FIESTA_tutorial_MA.html">Model-Assisted Estimators</a></li>
    <li><a class="dropdown-item" href="../articles/FIESTA_tutorial_SA.html">Small Area Estimators</a></li>
    <li><a class="dropdown-item" href="../articles/FIESTA_tutorial_PB.html">Photo-Based Estimators</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/USDAForestService/FIESTA/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Tree Data Summaries</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/USDAForestService/FIESTA/blob/master/vignettes/FIESTA_datSum_examples.Rmd" class="external-link"><code>vignettes/FIESTA_datSum_examples.Rmd</code></a></small>
      <div class="d-none name"><code>FIESTA_datSum_examples.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://usdaforestservice.github.io/FIESTA/">FIESTA</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>scipen <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="example-1">Example 1<a class="anchor" aria-label="anchor" href="#example-1"></a>
</h3>
<p>Let’s first start by using the sample data from FIESTA. Here, in it’s
most simple form, we get summed live basal area and net cubic-foot
volume by plot.</p>
<p>Note: datSum_opts has several parameter options, such as TPA and
rounding (See datSum_options() for other parameters).</p>
<p>What is TPA? TPA is Trees Per Acre (TPA_UNADJ). The TPA_UNADJ
variable is an acre-level expansion factor for measured trees. For FIA’s
annual inventory, fixed plot design: TPA equals the inverse of the plot
area (TPA = 1 / (Number of plots * area of plot).</p>
<p>FIA’s fixed plot design includes 4 subplots that are 24ft (7.3m)
radius (0.04154 acres) and 4 microplots that are 6.8ft (2.1m) radius
(0.00333 acres). Trees 5.0in (61cm) and greater are measured on the
subplots and trees less than 5.0in are measured on the microplots. TPA
for trees measured on the subplots is 6.018 (1 / (4 * 0.04143) and TPA
for trees measured on the microplots is 74.965 (1 / 4 * 0.00333)). So,
if we set TPA = TRUE, each tree 5.0in and greater represents 6.018 trees
and each tree less than 5.0in represents 74.965 trees.</p>
<p>In FIESTA, TPA is default to TRUE. This means anything in the
tsumvarlst (except TPA_UNADJ) is multiplied by TPA_UNADJ. If TPA =
FALSE, we simply get a sum of the count of trees measured on the FIA
plots.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sumdat1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/datSumTree.html">datSumTree</a></span><span class="op">(</span>tree <span class="op">=</span> <span class="va">WYtree</span>,</span>
<span>                      tsumvarlst <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BA"</span>, <span class="st">"VOLCFNET"</span><span class="op">)</span>,</span>
<span>                      tfilter <span class="op">=</span> <span class="st">"STATUSCD == 1"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: no DISPLAY variable so Tk is not available</span></span></code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Returned list items</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">sumdat1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "treedat"      "sumvars"      "tsumuniqueid" "treeqry"      "tfilter"     </span></span>
<span><span class="co">## [6] "tround"</span></span></code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## The first six rows of the summarized data table.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sumdat1</span><span class="op">$</span><span class="va">treedat</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Key: &lt;PLT_CN&gt;</span></span>
<span><span class="co">##            PLT_CN BA_TPA_live VOLCFNET_TPA_live</span></span>
<span><span class="co">##            &lt;char&gt;       &lt;num&gt;             &lt;num&gt;</span></span>
<span><span class="co">## 1: 40404729010690    14.27414          41.80061</span></span>
<span><span class="co">## 2: 40404730010690   119.74279        1563.03478</span></span>
<span><span class="co">## 3: 40404737010690     4.39131          25.08993</span></span>
<span><span class="co">## 4: 40404738010690    17.71590         137.52138</span></span>
<span><span class="co">## 5: 40404742010690    31.15636         448.67475</span></span>
<span><span class="co">## 6: 40404743010690    70.82421         907.80021</span></span></code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## The summarized variable names</span></span>
<span><span class="va">sumdat1</span><span class="op">$</span><span class="va">sumvars</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "BA_TPA_live"       "VOLCFNET_TPA_live"</span></span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## The query used to get data (use message to output in pretty format)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="va">sumdat1</span><span class="op">$</span><span class="va">treeqry</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## WITH tdat AS</span></span>
<span><span class="co">## (SELECT 'TREE' src, t.PLT_CN, t.CONDID, t.SUBP, t.TREE, t.BA, t.VOLCFNET, t.TPA_UNADJ</span></span>
<span><span class="co">##  FROM treex t</span></span>
<span><span class="co">##  WHERE STATUSCD = 1)</span></span>
<span><span class="co">## -------------------------------------------</span></span>
<span><span class="co">## SELECT tdat.PLT_CN,   </span></span>
<span><span class="co">##   COALESCE(SUM(BA * TPA_UNADJ),0) AS BA_TPA_live,  </span></span>
<span><span class="co">##   COALESCE(SUM(VOLCFNET * TPA_UNADJ),0) AS VOLCFNET_TPA_live</span></span>
<span><span class="co">## FROM tdat</span></span>
<span><span class="co">## GROUP BY tdat.PLT_CN</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="example-2">Example 2<a class="anchor" aria-label="anchor" href="#example-2"></a>
</h3>
<p>So, let’s now get a little more familiar with this function by
showing what else it can do.</p>
<p>This time we will do the following things: 1) Add custom names
(<code>tsumvarnmlst</code>) 2) summarize by plot and species
(<code>bydomainlst</code>) 3) Add a derived variable
(<code>tderive</code>) 4) Exclude woodland species
(<code>woodland</code>) 5) Include seedlings (<code>seedlings</code>) 6)
include a per acre count (i.e., TPA_UNADJ)</p>
<p>Note: Derived variables are not multiplied by TPA_UNADJ when the
default is set (<code>datSum_opts(TPA = TRUE)</code>). Therefore, you
must include it in the derived statement if it is desired. Furthermore
variables defined in <code>tderive</code> should not be included in
<code>tsumvarlst</code>.</p>
<p>Notice that the definitions for the derived variables are written in
SQL syntax. This is required so that the statement can be appropriately
plugged into the query that is used to generate collect the data.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sumdat2</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../reference/datSumTree.html">datSumTree</a></span><span class="op">(</span>tree <span class="op">=</span> <span class="va">WYtree</span>,</span>
<span>             seed <span class="op">=</span> <span class="va">WYseed</span>,</span>
<span>             tsumvarlst <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BA"</span>, <span class="st">"VOLCFNET"</span>, <span class="st">"TPA_UNADJ"</span><span class="op">)</span>,</span>
<span>             tsumvarnmlst <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BA_LIVE"</span>, <span class="st">"VOLNET_LIVE"</span>, <span class="st">"COUNT"</span><span class="op">)</span>,</span>
<span>             bydomainlst <span class="op">=</span> <span class="st">"SPCD"</span>,</span>
<span>             tderive <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>SDI <span class="op">=</span> <span class="st">'(POWER(DIA / 10, 1.605)) * TPA_UNADJ'</span><span class="op">)</span>,</span>
<span>             woodland <span class="op">=</span> <span class="st">"N"</span>,</span>
<span>             seedlings <span class="op">=</span> <span class="st">"Y"</span>,</span>
<span>             tfilter <span class="op">=</span> <span class="st">"STATUSCD == 1"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Returned list items</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">sumdat2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "treedat"      "sumvars"      "tsumuniqueid" "treeqry"      "tfilter"     </span></span>
<span><span class="co">## [6] "tdomainlst"   "pcdomainlst"  "tround"</span></span></code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## The first six rows of the summarized data table.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sumdat2</span><span class="op">$</span><span class="va">treedat</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Key: &lt;PLT_CN&gt;</span></span>
<span><span class="co">##            PLT_CN  SPCD COUNT_TREE  BA_LIVE VOLNET_LIVE       SDI COUNT_SEED</span></span>
<span><span class="co">##            &lt;char&gt; &lt;num&gt;      &lt;num&gt;    &lt;num&gt;       &lt;num&gt;     &lt;num&gt;      &lt;num&gt;</span></span>
<span><span class="co">## 1: 40404729010690   113   18.05414  6.02915    41.80061  12.00007   74.96528</span></span>
<span><span class="co">## 2: 40404730010690   108    6.01805  1.60830    21.73192   3.39498    0.00000</span></span>
<span><span class="co">## 3: 40404730010690   113   36.10828 12.56114   124.99617  24.57426    0.00000</span></span>
<span><span class="co">## 4: 40404730010690   122  135.14574 41.04085   612.11646  73.29117    0.00000</span></span>
<span><span class="co">## 5: 40404730010690   202  138.41506 64.53249   804.19022 118.74775  224.89585</span></span>
<span><span class="co">## 6: 40404737010690   113    6.01805  1.94604    10.21924   3.95615    0.00000</span></span>
<span><span class="co">##        COUNT</span></span>
<span><span class="co">##        &lt;num&gt;</span></span>
<span><span class="co">## 1:  93.01942</span></span>
<span><span class="co">## 2:   6.01805</span></span>
<span><span class="co">## 3:  36.10828</span></span>
<span><span class="co">## 4: 135.14574</span></span>
<span><span class="co">## 5: 363.31090</span></span>
<span><span class="co">## 6:   6.01805</span></span></code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## The summarized variable names</span></span>
<span><span class="va">sumdat2</span><span class="op">$</span><span class="va">sumvars</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "COUNT_TREE"  "COUNT_SEED"  "COUNT"       "BA_LIVE"     "VOLNET_LIVE"</span></span>
<span><span class="co">## [6] "SDI"</span></span></code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## The query used to get data (use message to output in pretty format)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="va">sumdat2</span><span class="op">$</span><span class="va">treeqry</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## WITH tdat AS</span></span>
<span><span class="co">## (SELECT 'TREE' src, t.PLT_CN, t.CONDID, t.SUBP, t.TREE, t.SPCD, t.TPA_UNADJ, t.BA, t.VOLCFNET, t.DIA</span></span>
<span><span class="co">##  FROM treex t</span></span>
<span><span class="co">##  JOIN ref_species ref ON (ref.SPCD = t.SPCD)</span></span>
<span><span class="co">##  WHERE STATUSCD = 1 AND WOODLAND = 'N'</span></span>
<span><span class="co">##  UNION</span></span>
<span><span class="co">##  SELECT 'SEED' src, s.PLT_CN, s.CONDID, s.SUBP, 0, s.SPCD, s.TPA_UNADJ, 'null', 'null', 'null'</span></span>
<span><span class="co">##  FROM seedx s </span></span>
<span><span class="co">##  JOIN ref_species ref ON (ref.SPCD = s.SPCD)</span></span>
<span><span class="co">##  WHERE WOODLAND = 'N')</span></span>
<span><span class="co">## -------------------------------------------</span></span>
<span><span class="co">## SELECT tdat.PLT_CN, SPCD,   </span></span>
<span><span class="co">##   COALESCE(SUM(CASE WHEN src = 'TREE' THEN TPA_UNADJ ELSE 0 END),0) AS COUNT_TREE,  </span></span>
<span><span class="co">##   COALESCE(SUM(CASE WHEN src = 'TREE' THEN BA * TPA_UNADJ ELSE 0 END),0) AS BA_LIVE,  </span></span>
<span><span class="co">##   COALESCE(SUM(CASE WHEN src = 'TREE' THEN VOLCFNET * TPA_UNADJ ELSE 0 END),0) AS VOLNET_LIVE,  </span></span>
<span><span class="co">##   COALESCE(SUM(CASE WHEN src = 'TREE' THEN (POWER(DIA / 10, 1.605)) * TPA_UNADJ ELSE 0 END),0) AS SDI, </span></span>
<span><span class="co">##   COALESCE(SUM(CASE WHEN src = 'SEED' THEN TPA_UNADJ ELSE 0 END),0) AS COUNT_SEED, </span></span>
<span><span class="co">##   COALESCE(SUM(TPA_UNADJ),0) AS COUNT</span></span>
<span><span class="co">## FROM tdat</span></span>
<span><span class="co">## GROUP BY tdat.PLT_CN, SPCD</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="example-3">Example 3:<a class="anchor" aria-label="anchor" href="#example-3"></a>
</h3>
<p>Now, let’s go further and include classified domains to summarize by.
1) Classify species into 3 classes (C-Conifer;W-Woodland;H-Hardwood) 2)
Specify diameter breaks 3) Add species look up table and diameter breaks
to domclassify, while also adding variables classified to
bydomainlst.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## First, find unique species in WYtree</span></span>
<span><span class="va">spcdlst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">WYtree</span><span class="op">$</span><span class="va">SPCD</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## specify new class values for each unique species in WYtree</span></span>
<span><span class="va">spcdlut</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>SPCD <span class="op">=</span> <span class="va">spcdlst</span>,</span>
<span>                      SPCDCL <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"C"</span>,<span class="st">"W"</span>,<span class="st">"W"</span>,<span class="st">"C"</span>,<span class="st">"C"</span>,<span class="st">"C"</span>,<span class="st">"W"</span>,<span class="st">"C"</span>,<span class="st">"C"</span>,<span class="st">"C"</span>,<span class="st">"C"</span>,<span class="st">"H"</span>,<span class="st">"H"</span>,<span class="st">"W"</span>,<span class="st">"H"</span>,<span class="st">"H"</span>,<span class="st">"H"</span>,<span class="st">"H"</span>,<span class="st">"H"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Next, find unique diameters in WYtree</span></span>
<span><span class="va">dialst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">WYtree</span><span class="op">$</span><span class="va">DIA</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## specify break values to define new diameter class</span></span>
<span><span class="va">diabrks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">20</span>,<span class="fl">40</span>,<span class="fl">80</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sumdat3</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../reference/datSumTree.html">datSumTree</a></span><span class="op">(</span>tree <span class="op">=</span> <span class="va">WYtree</span>,</span>
<span>             seed <span class="op">=</span> <span class="va">WYseed</span>,</span>
<span>             tsumvarlst <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BA"</span>, <span class="st">"VOLCFNET"</span>, <span class="st">"TPA_UNADJ"</span><span class="op">)</span>,</span>
<span>             tsumvarnmlst <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BA_LIVE"</span>, <span class="st">"VOLNET_LIVE"</span>, <span class="st">"COUNT"</span><span class="op">)</span>,</span>
<span>             bydomainlst <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SPCD"</span>, <span class="st">"DIA"</span><span class="op">)</span>,</span>
<span>             tderive <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>SDI <span class="op">=</span> <span class="st">'(POWER(DIA / 10, 1.605)) * TPA_UNADJ'</span><span class="op">)</span>,</span>
<span>             domclassify <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>SPCD <span class="op">=</span> <span class="va">spcdlut</span>, DIA <span class="op">=</span> <span class="va">diabrks</span><span class="op">)</span>,</span>
<span>             woodland <span class="op">=</span> <span class="st">"N"</span>,</span>
<span>             seedlings <span class="op">=</span> <span class="st">"Y"</span>,</span>
<span>             tfilter <span class="op">=</span> <span class="st">"STATUSCD == 1"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Returned list items</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">sumdat3</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "treedat"       "sumvars"       "tsumuniqueid"  "treeqry"      </span></span>
<span><span class="co">## [5] "tfilter"       "tdomainlst"    "pcdomainlst"   "classifynmlst"</span></span>
<span><span class="co">## [9] "tround"</span></span></code></pre>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## The first six rows of the summarized data table.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sumdat3</span><span class="op">$</span><span class="va">treedat</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Key: &lt;PLT_CN&gt;</span></span>
<span><span class="co">##            PLT_CN SPCDCL  DIACL COUNT_TREE BA_LIVE VOLNET_LIVE      SDI</span></span>
<span><span class="co">##            &lt;char&gt; &lt;char&gt; &lt;char&gt;      &lt;num&gt;   &lt;num&gt;       &lt;num&gt;    &lt;num&gt;</span></span>
<span><span class="co">## 1: 40404729010690      C   0-20    6.01805 0.88752     3.79245  2.10689</span></span>
<span><span class="co">## 2: 40404729010690      C   0-20    6.01805 2.54177    14.99432  4.90174</span></span>
<span><span class="co">## 3: 40404729010690      C   0-20    6.01805 2.59986    23.01384  4.99145</span></span>
<span><span class="co">## 4: 40404729010690      C    80+    0.00000 0.00000     0.00000  0.00000</span></span>
<span><span class="co">## 5: 40404730010690      C   0-20   74.96528 3.67975     0.00000 10.85525</span></span>
<span><span class="co">## 6: 40404730010690      C   0-20    6.01805 0.85371     6.26437  2.04223</span></span>
<span><span class="co">##    COUNT_SEED    COUNT</span></span>
<span><span class="co">##         &lt;num&gt;    &lt;num&gt;</span></span>
<span><span class="co">## 1:    0.00000  6.01805</span></span>
<span><span class="co">## 2:    0.00000  6.01805</span></span>
<span><span class="co">## 3:    0.00000  6.01805</span></span>
<span><span class="co">## 4:   74.96528 74.96528</span></span>
<span><span class="co">## 5:    0.00000 74.96528</span></span>
<span><span class="co">## 6:    0.00000  6.01805</span></span></code></pre>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## The summarized variable names</span></span>
<span><span class="va">sumdat3</span><span class="op">$</span><span class="va">sumvars</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "COUNT_TREE"  "COUNT_SEED"  "COUNT"       "BA_LIVE"     "VOLNET_LIVE"</span></span>
<span><span class="co">## [6] "SDI"</span></span></code></pre>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## The query used to get data (use message to output in pretty format)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="va">sumdat3</span><span class="op">$</span><span class="va">treeqry</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## WITH tdat AS</span></span>
<span><span class="co">## (SELECT 'TREE' src, t.PLT_CN, t.CONDID, t.SUBP, t.TREE, t.SPCD, t.TPA_UNADJ, t.DIA, t.BA, t.VOLCFNET</span></span>
<span><span class="co">##  FROM treex t</span></span>
<span><span class="co">##  JOIN ref_species ref ON (ref.SPCD = t.SPCD)</span></span>
<span><span class="co">##  WHERE STATUSCD = 1 AND WOODLAND = 'N'</span></span>
<span><span class="co">##  UNION</span></span>
<span><span class="co">##  SELECT 'SEED' src, s.PLT_CN, s.CONDID, s.SUBP, 0, s.SPCD, s.TPA_UNADJ, 'null', 'null', 'null'</span></span>
<span><span class="co">##  FROM seedx s </span></span>
<span><span class="co">##  JOIN ref_species ref ON (ref.SPCD = s.SPCD)</span></span>
<span><span class="co">##  WHERE WOODLAND = 'N')</span></span>
<span><span class="co">## -------------------------------------------</span></span>
<span><span class="co">## SELECT tdat.PLT_CN, </span></span>
<span><span class="co">##   (CASE</span></span>
<span><span class="co">##    WHEN tdat.SPCD = 19 THEN 'C'</span></span>
<span><span class="co">##    WHEN tdat.SPCD = 65 THEN 'W'</span></span>
<span><span class="co">##    WHEN tdat.SPCD = 66 THEN 'W'</span></span>
<span><span class="co">##    WHEN tdat.SPCD = 93 THEN 'C'</span></span>
<span><span class="co">##    WHEN tdat.SPCD = 96 THEN 'C'</span></span>
<span><span class="co">##    WHEN tdat.SPCD = 101 THEN 'C'</span></span>
<span><span class="co">##    WHEN tdat.SPCD = 106 THEN 'W'</span></span>
<span><span class="co">##    WHEN tdat.SPCD = 108 THEN 'C'</span></span>
<span><span class="co">##    WHEN tdat.SPCD = 113 THEN 'C'</span></span>
<span><span class="co">##    WHEN tdat.SPCD = 122 THEN 'C'</span></span>
<span><span class="co">##    WHEN tdat.SPCD = 202 THEN 'C'</span></span>
<span><span class="co">##    WHEN tdat.SPCD = 313 THEN 'H'</span></span>
<span><span class="co">##    WHEN tdat.SPCD = 375 THEN 'H'</span></span>
<span><span class="co">##    WHEN tdat.SPCD = 475 THEN 'W'</span></span>
<span><span class="co">##    WHEN tdat.SPCD = 544 THEN 'H'</span></span>
<span><span class="co">##    WHEN tdat.SPCD = 745 THEN 'H'</span></span>
<span><span class="co">##    WHEN tdat.SPCD = 746 THEN 'H'</span></span>
<span><span class="co">##    WHEN tdat.SPCD = 749 THEN 'H'</span></span>
<span><span class="co">##    WHEN tdat.SPCD = 823 THEN 'H' END) AS SPCDCL,</span></span>
<span><span class="co">##   (CASE </span></span>
<span><span class="co">##    WHEN tdat.DIA IS NULL THEN '&lt;1'</span></span>
<span><span class="co">##    WHEN tdat.DIA &gt;= 0 AND tdat.DIA &lt; 20 THEN '0-20'</span></span>
<span><span class="co">##    WHEN tdat.DIA &gt;= 20 AND tdat.DIA &lt; 40 THEN '20-40'</span></span>
<span><span class="co">##    WHEN tdat.DIA &gt;= 40 AND tdat.DIA &lt; 80 THEN '40-80'</span></span>
<span><span class="co">##    WHEN tdat.DIA &gt;= 80 THEN '80+' END) AS DIACL,   </span></span>
<span><span class="co">##   COALESCE(SUM(CASE WHEN src = 'TREE' THEN TPA_UNADJ ELSE 0 END),0) AS COUNT_TREE,  </span></span>
<span><span class="co">##   COALESCE(SUM(CASE WHEN src = 'TREE' THEN BA * TPA_UNADJ ELSE 0 END),0) AS BA_LIVE,  </span></span>
<span><span class="co">##   COALESCE(SUM(CASE WHEN src = 'TREE' THEN VOLCFNET * TPA_UNADJ ELSE 0 END),0) AS VOLNET_LIVE,  </span></span>
<span><span class="co">##   COALESCE(SUM(CASE WHEN src = 'TREE' THEN (POWER(DIA / 10, 1.605)) * TPA_UNADJ ELSE 0 END),0) AS SDI, </span></span>
<span><span class="co">##   COALESCE(SUM(CASE WHEN src = 'SEED' THEN TPA_UNADJ ELSE 0 END),0) AS COUNT_SEED, </span></span>
<span><span class="co">##   COALESCE(SUM(TPA_UNADJ),0) AS COUNT</span></span>
<span><span class="co">## FROM tdat</span></span>
<span><span class="co">## GROUP BY tdat.PLT_CN, DIA</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="example-4">Example 4:<a class="anchor" aria-label="anchor" href="#example-4"></a>
</h3>
<p>Lastly, let’s play around with some additional derived variables:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sumdat4</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../reference/datSumTree.html">datSumTree</a></span><span class="op">(</span>tree <span class="op">=</span> <span class="va">WYtree</span>,</span>
<span>             tderive <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>LIVE_BA <span class="op">=</span> <span class="st">"SUM(power(DIA, 2) * 0.005454 * TPA_UNADJ * (CASE WHEN STATUSCD = 1 THEN 1 ELSE 0 END))"</span>,</span>
<span>                            DEAD_BA <span class="op">=</span> <span class="st">"SUM(power(DIA, 2) * 0.005454 * TPA_UNADJ * (CASE WHEN STATUSCD = 2 THEN 1 ELSE 0 END))"</span>,</span>
<span>                            SDI <span class="op">=</span> <span class="st">"SUM((POWER(DIA / 10, 1.605)) * TPA_UNADJ)"</span>,</span>
<span>                            QMD <span class="op">=</span> <span class="st">"sqrt(SUM(power(DIA, 2) * 0.005454 * TPA_UNADJ) / (SUM(TPA_UNADJ) * 0.005454))"</span>,</span>
<span>                            MEAN_DIA <span class="op">=</span> <span class="st">"AVG(DIA)"</span>,</span>
<span>                            MEDIAN_DIA <span class="op">=</span> <span class="st">"MEDIAN(DIA)"</span>,</span>
<span>                            LIVELESS20 <span class="op">=</span> <span class="st">"SUM(TPA_UNADJ * (CASE WHEN DIA &lt; 10 THEN 1 ELSE 0 END))"</span>,</span>
<span>                            LIVE10to30 <span class="op">=</span> <span class="st">"SUM(TPA_UNADJ * (CASE WHEN DIA &gt; 10 AND DIA &lt;= 30 THEN 1 ELSE 0 END))"</span><span class="op">)</span><span class="op">)</span></span>
<span>                          </span>
<span><span class="co">## Returned list items</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">sumdat4</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "treedat"      "sumvars"      "tsumuniqueid" "treeqry"      "tround"</span></span></code></pre>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## The first six rows of the summarized data table.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sumdat4</span><span class="op">$</span><span class="va">treedat</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Key: &lt;PLT_CN&gt;</span></span>
<span><span class="co">##            PLT_CN   LIVE_BA  DEAD_BA       SDI      QMD MEAN_DIA MEDIAN_DIA</span></span>
<span><span class="co">##            &lt;char&gt;     &lt;num&gt;    &lt;num&gt;     &lt;num&gt;    &lt;num&gt;    &lt;num&gt;      &lt;num&gt;</span></span>
<span><span class="co">## 1: 40404729010690  14.27414  2.83356  32.50917  8.62902  8.31429       8.80</span></span>
<span><span class="co">## 2: 40404730010690 119.74279  7.48450 234.13906  8.36041  8.65455       7.60</span></span>
<span><span class="co">## 3: 40404737010690   4.39131  4.49306  17.14599  8.22618  7.90000       7.00</span></span>
<span><span class="co">## 4: 40404738010690  17.71590 19.05506  67.95588  8.94547  8.45714       7.65</span></span>
<span><span class="co">## 5: 40404742010690  31.15636  0.00000  53.66041 11.64499 11.60000      11.40</span></span>
<span><span class="co">## 6: 40404743010690  70.82421  5.10750 146.05962  7.09833  8.69565       7.50</span></span>
<span><span class="co">##    LIVELESS20 LIVE10to30</span></span>
<span><span class="co">##         &lt;num&gt;      &lt;num&gt;</span></span>
<span><span class="co">## 1:   30.09023   12.03609</span></span>
<span><span class="co">## 2:  249.48862   78.23460</span></span>
<span><span class="co">## 3:   18.05414    6.01805</span></span>
<span><span class="co">## 4:   60.18046   18.05414</span></span>
<span><span class="co">## 5:    6.01805   36.10828</span></span>
<span><span class="co">## 6:  222.14712   54.16241</span></span></code></pre>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## The summarized variable names</span></span>
<span><span class="va">sumdat4</span><span class="op">$</span><span class="va">sumvars</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "LIVE_BA"    "DEAD_BA"    "SDI"        "QMD"        "MEAN_DIA"  </span></span>
<span><span class="co">## [6] "MEDIAN_DIA" "LIVELESS20" "LIVE10to30"</span></span></code></pre>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## The query used to get data (use message to output in pretty format)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="va">sumdat4</span><span class="op">$</span><span class="va">treeqry</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## WITH tdat AS</span></span>
<span><span class="co">## (SELECT 'TREE' src, t.PLT_CN, t.CONDID, t.SUBP, t.TREE, t.STATUSCD, t.DIA, t.TPA_UNADJ</span></span>
<span><span class="co">##  FROM treex t)</span></span>
<span><span class="co">## -------------------------------------------</span></span>
<span><span class="co">## SELECT tdat.PLT_CN,   </span></span>
<span><span class="co">##   SUM(power(DIA, 2) * 0.005454 * TPA_UNADJ * (CASE WHEN STATUSCD = 1 THEN 1 ELSE 0 END)) AS LIVE_BA,  </span></span>
<span><span class="co">##   SUM(power(DIA, 2) * 0.005454 * TPA_UNADJ * (CASE WHEN STATUSCD = 2 THEN 1 ELSE 0 END)) AS DEAD_BA,  </span></span>
<span><span class="co">##   SUM((POWER(DIA / 10, 1.605)) * TPA_UNADJ) AS SDI,  </span></span>
<span><span class="co">##   sqrt(SUM(power(DIA, 2) * 0.005454 * TPA_UNADJ) / (SUM(TPA_UNADJ) * 0.005454)) AS QMD,  </span></span>
<span><span class="co">##   AVG(DIA) AS MEAN_DIA,  </span></span>
<span><span class="co">##   MEDIAN(DIA) AS MEDIAN_DIA,  </span></span>
<span><span class="co">##   SUM(TPA_UNADJ * (CASE WHEN DIA &lt; 10 THEN 1 ELSE 0 END)) AS LIVELESS20,  </span></span>
<span><span class="co">##   SUM(TPA_UNADJ * (CASE WHEN DIA &gt; 10 AND DIA &lt;= 30 THEN 1 ELSE 0 END)) AS LIVE10to30</span></span>
<span><span class="co">## FROM tdat</span></span>
<span><span class="co">## GROUP BY tdat.PLT_CN</span></span></code></pre>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Tracey Frescino, Gretchen Moisen, Paul Patterson, Chris Toney, Grayson White, Joshua Yamamoto.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
