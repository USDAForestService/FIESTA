<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Database - Gets stratification information from FIA database. — DBgetStrata • FIESTA</title><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Database - Gets stratification information from FIA database. — DBgetStrata"><meta name="description" content="Gets strata information from FIA's Oracle database or FIA DataMart,
including: (1) strata and estimation unit assignment per plot; (2) total
area by estimation unit; (3) pixel counts and number plots by
strata/estimation unit. Include a data frame of plots, states, or evaluation
information."><meta property="og:description" content="Gets strata information from FIA's Oracle database or FIA DataMart,
including: (1) strata and estimation unit assignment per plot; (2) total
area by estimation unit; (3) pixel counts and number plots by
strata/estimation unit. Include a data frame of plots, states, or evaluation
information."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">FIESTA</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.6.4.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/FIESTA_tutorial_GB.html">Green-book Estimators</a></li>
    <li><a class="dropdown-item" href="../articles/FIESTA_tutorial_MA.html">Model-Assisted Estimators</a></li>
    <li><a class="dropdown-item" href="../articles/FIESTA_tutorial_SA.html">Small Area Estimators</a></li>
    <li><a class="dropdown-item" href="../articles/FIESTA_tutorial_PB.html">Photo-Based Estimators</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/USDAForestService/FIESTA/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Database - Gets stratification information from FIA database.</h1>
      <small class="dont-index">Source: <a href="https://github.com/USDAForestService/FIESTA/blob/master/R/DBgetStrata.R" class="external-link"><code>R/DBgetStrata.R</code></a></small>
      <div class="d-none name"><code>DBgetStrata.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Gets strata information from FIA's Oracle database or FIA DataMart,
including: (1) strata and estimation unit assignment per plot; (2) total
area by estimation unit; (3) pixel counts and number plots by
strata/estimation unit. Include a data frame of plots, states, or evaluation
information.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">DBgetStrata</span><span class="op">(</span></span>
<span>  dat <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  uniqueid <span class="op">=</span> <span class="st">"CN"</span>,</span>
<span>  datsource <span class="op">=</span> <span class="st">"datamart"</span>,</span>
<span>  data_dsn <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  states <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  eval_opts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/FIESTAutils/man/eval_options.html" class="external-link">eval_options</a></span><span class="op">(</span>Cur <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  savedata <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  getassgn <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  pop_plot_stratum_assgn <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  savedata_opts <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  dbconn <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  dbconnopen <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  evalInfo <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-dat">dat<a class="anchor" aria-label="anchor" href="#arg-dat"></a></dt>
<dd><p>Data frame, comma-delimited file (*.csv), or shapefile (*.shp).
The strata value is merged to this table and returned as a data frame. See
details for necessary variables.</p></dd>


<dt id="arg-uniqueid">uniqueid<a class="anchor" aria-label="anchor" href="#arg-uniqueid"></a></dt>
<dd><p>String. The unique plot identifier of dat (e.g., 'CN').</p></dd>


<dt id="arg-datsource">datsource<a class="anchor" aria-label="anchor" href="#arg-datsource"></a></dt>
<dd><p>String. Source of data ('datamart', 'sqlite').</p></dd>


<dt id="arg-data-dsn">data_dsn<a class="anchor" aria-label="anchor" href="#arg-data-dsn"></a></dt>
<dd><p>String. If datsource='sqlite', the name of SQLite database
(*.sqlite).</p></dd>


<dt id="arg-states">states<a class="anchor" aria-label="anchor" href="#arg-states"></a></dt>
<dd><p>String or numeric vector. Name(s) (e.g., 'Arizona','New
Mexico') or code(s) (e.g., 4, 35) of states for strata if dat=NULL.</p></dd>


<dt id="arg-eval-opts">eval_opts<a class="anchor" aria-label="anchor" href="#arg-eval-opts"></a></dt>
<dd><p>List of evaluation options for 'FIA' or 'custom'
evaluations to determine the set of data returned. See help(eval_options)
for a list of options.</p></dd>


<dt id="arg-savedata">savedata<a class="anchor" aria-label="anchor" href="#arg-savedata"></a></dt>
<dd><p>Logical. If TRUE, writes output to outfolder.</p></dd>


<dt id="arg-getassgn">getassgn<a class="anchor" aria-label="anchor" href="#arg-getassgn"></a></dt>
<dd><p>Logical. If TRUE, extracts plot assignments from
pop_plot_stratum_assgn table in database.</p></dd>


<dt id="arg-pop-plot-stratum-assgn">pop_plot_stratum_assgn<a class="anchor" aria-label="anchor" href="#arg-pop-plot-stratum-assgn"></a></dt>
<dd><p>Data frame. The pop_plot_stratum_assgn for
state(s).</p></dd>


<dt id="arg-savedata-opts">savedata_opts<a class="anchor" aria-label="anchor" href="#arg-savedata-opts"></a></dt>
<dd><p>List. See help(savedata_options()) for a list
of options. Only used when savedata = TRUE.</p></dd>


<dt id="arg-dbconn">dbconn<a class="anchor" aria-label="anchor" href="#arg-dbconn"></a></dt>
<dd><p>Open database connection.</p></dd>


<dt id="arg-dbconnopen">dbconnopen<a class="anchor" aria-label="anchor" href="#arg-dbconnopen"></a></dt>
<dd><p>Logical. If TRUE, the dbconn connection is not closed.</p></dd>


<dt id="arg-evalinfo">evalInfo<a class="anchor" aria-label="anchor" href="#arg-evalinfo"></a></dt>
<dd><p>List. List object output from DBgetEvalid or DBgetXY</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>For extendibility.
FIESTA functions.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>FIAstrata - a list of the following objects:</p>
<dl><dt>pltassgn</dt>
<dd><p>Data
frame. Plot-level strata/estimation unit assignment.  If dat is not NULL,
strata/estimation unit variables are appended to dat.</p></dd>
 <dt>pltassgnid</dt>
<dd><p>String. Name of unique identifier of plot in pltassgn.</p></dd>
 <dt>unitarea</dt>
<dd><p>Data frame. Total acres by estimation unit.</p></dd>
 <dt>unitvar</dt>
<dd><p>String. Name
of the estimation unit variable (ESTN_UNIT).</p></dd>
 <dt>areavar</dt>
<dd><p>String. Name
of the acre variable (ACRES).</p></dd>
 <dt>stratalut</dt>
<dd><p>Data frame. Strata look-up
table with summarized pixel counts (P1POINTCNT) by strata/estimation unit.</p></dd>

<dt>strvar</dt>
<dd><p>String. Name of the strata variable (STRATA).</p></dd>

<dt>strwtvar</dt>
<dd><p>String. Name of the strata weight variable (P1POINTCNT).</p></dd>

<dt>evalid</dt>
<dd><p>List. evalid by state.</p></dd>


</dl><p>Outputs to outfolder (if savedata=TRUE):</p><table class="table table"><tr><td></td><td>- CSV file of
pltassgn (*'date'.csv).</td></tr><tr><td></td><td>- CSV file of unitarea (*'date'.csv).</td></tr><tr><td></td><td>- CSV file of stratalut (*'date'.csv).</td></tr><tr><td></td><td>- If collapsed, a CSV
file of original classes and new collapsed classes.</td></tr></table></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The following variables must be present in dat: STATECD, UNITCD, INVYR, a
uniqueid (e.g. "PLT_CN"), and PLOT_STATUS_CD (if nonsampled plots in
dataset).</p>
<p>FIADB TABLES USED:</p><table class="table table"><tr><td></td><td>FS_FIADB.SURVEY</td><td>To get latest
inventory year.</td></tr><tr><td></td><td>FS_FIADB.POP_EVAL</td><td>To get EVALID and EVALID
years.</td></tr><tr><td></td><td>FS_FIADB.POP_ESTN_UNIT</td><td>To get total area by estimation
unit (AREATOT_EU-includes water).</td></tr><tr><td></td><td>FS_FIADB.POP_STRATUM</td><td>To get
pixel counts by stratum and estimation unit.</td></tr><tr><td></td><td>FS_FIADB.POP_PLOT_STRATUM_ASSGN</td><td>To get estimation unit &amp; stratum
assignment for each plot.</td></tr></table><p>Area by estimation unit includes total area for all plots (Type="CURR").</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>Steps used in data extraction:</p>
<ol><li><p>Get EVALID and EVALID years by state - DBgetEvalid().</p></li>
<li><p>unitarea: get total area by estimation unit for EVALID
(POP_ESTN_UNIT).</p></li>
<li><p>stratalut: get pixel counts by estimation unit and
stratum for EVALID (POP_STRATUM).</p></li>
<li><p>pltassgn: get estimation unit and
stratum assignment for each plot for EVALID.  (POP_PLOT_STRATUM_ASSGN).</p></li>
<li><p>If dat is not NULL, merge pltassgn assignment to dat.</p></li>
<li><p>Merge
number of plots to stratalut</p></li>
<li><p>Check for only 1 MEASYEAR or 1 INVYR and
number of plots by strata/estimation unit.  If less than minimumnum plots
per strata/estimation unit collapse using the following algorithm.</p></li>
</ol><p>Strata collapsing: <br> If there are less than minplotnum (10) plots in the
smallest strata of the estimation unit, these plots are grouped with the
larger strata in the same estimation unit and defined as the highest strata
value. If, after grouping, there are still less than minplotnum, all of
these plots are combined with the corresponding strata of the estimation
unit above.  If there are no records above, then they are combined with the
estimation unit below.  The process repeats, grouping the strata to the
highest strata value if necessary.  All grouping is restrained within survey
units (UNITCD).</p>
<p>More than one evaluation: <br> If attributing a table of plots and there are
plots that have been visited more than once, all plots are assigned an
estimation unit and strata value, but the area and strata proportions are
from the most current evaluation for the dataset. The plots outside the most
current evaluation are attributes with values from the next most current
evaluation occurring in the database.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Tracey S. Frescino</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Get strata for the most current evaluation of a state (ex. Wyoming)</span></span></span>
<span class="r-in"><span><span class="va">WYstrat1</span> <span class="op">&lt;-</span> <span class="fu">DBgetStrata</span><span class="op">(</span>states <span class="op">=</span> <span class="st">"Wyoming"</span>,</span></span>
<span class="r-in"><span>                        eval_opts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Cur <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">WYstrat1</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">WYstrat1</span><span class="op">$</span><span class="va">pltassgn</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">WYstrat1</span><span class="op">$</span><span class="va">unitarea</span></span></span>
<span class="r-in"><span><span class="va">WYstrat1</span><span class="op">$</span><span class="va">unitvar</span></span></span>
<span class="r-in"><span><span class="va">WYstrat1</span><span class="op">$</span><span class="va">areavar</span></span></span>
<span class="r-in"><span><span class="va">WYstrat1</span><span class="op">$</span><span class="va">strvar</span></span></span>
<span class="r-in"><span><span class="va">WYstrat1</span><span class="op">$</span><span class="va">evalid</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Get strata information for a specific set of plots</span></span></span>
<span class="r-in"><span><span class="va">WYstrat4</span> <span class="op">&lt;-</span> <span class="fu">DBgetStrata</span><span class="op">(</span>dat <span class="op">=</span> <span class="va">WYplt</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">WYstrat4</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">WYstrat4</span><span class="op">$</span><span class="va">pltassgn</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">WYstrat4</span><span class="op">$</span><span class="va">unitarea</span></span></span>
<span class="r-in"><span><span class="va">WYstrat4</span><span class="op">$</span><span class="va">evalid</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Tracey Frescino, Gretchen Moisen, Paul Patterson, Chris Toney, Grayson White, Joshua Yamamoto.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

